{"ast":null,"code":"import \"antd/lib/card/style/css\";\nimport _Card from \"antd/lib/card\";\nimport \"antd/lib/table/style/css\";\nimport _Table from \"antd/lib/table\";\nimport \"antd/lib/statistic/style/css\";\nimport _Statistic from \"antd/lib/statistic\";\nimport \"antd/lib/alert/style/css\";\nimport _Alert from \"antd/lib/alert\";\nimport \"antd/lib/tag/style/css\";\nimport _Tag from \"antd/lib/tag\";\nimport \"antd/lib/tooltip/style/css\";\nimport _Tooltip from \"antd/lib/tooltip\";\nimport \"antd/lib/popconfirm/style/css\";\nimport _Popconfirm from \"antd/lib/popconfirm\";\nimport \"antd/lib/button/style/css\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/popover/style/css\";\nimport _Popover from \"antd/lib/popover\";\nimport \"antd/lib/descriptions/style/css\";\nimport _Descriptions from \"antd/lib/descriptions\";\nimport \"antd/lib/page-header/style/css\";\nimport _PageHeader from \"antd/lib/page-header\";\nimport \"antd/lib/typography/style/css\";\nimport _Typography from \"antd/lib/typography\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport \"antd/lib/form/style/css\";\nimport _Form from \"antd/lib/form\";\nimport \"antd/lib/modal/style/css\";\nimport _Modal from \"antd/lib/modal\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport \"antd/lib/input/style/css\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/input-number/style/css\";\nimport _InputNumber from \"antd/lib/input-number\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function () { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from 'react';\nimport Head from 'next/head';\nimport Link from 'next/link';\nimport { UserOutlined, SolutionOutlined, CheckOutlined, TeamOutlined, GlobalOutlined, CoffeeOutlined } from '@ant-design/icons';\nimport Container, { Space, TextCenter } from '@/components/container';\nimport { Context, defaultContext } from '@/utils/global';\nimport Steps from '@/components/steps';\nimport { LoginModal } from '@/components/login';\nimport { get, finish, update, insert, land, out } from '@/extensions/queue/api';\nimport moment from 'moment';\nimport TextArea from 'antd/lib/input/TextArea';\nimport ShowNotification, { H5Notification } from '@/utils/notification';\nimport { withRouter } from 'next/router';\nimport If from '@/components/if';\n\nvar QueueDetail = /*#__PURE__*/function (_React$Component) {\n  _inherits(QueueDetail, _React$Component);\n\n  var _super = _createSuper(QueueDetail);\n\n  function QueueDetail(props) {\n    var _this;\n\n    _classCallCheck(this, QueueDetail);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"context\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"ws\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"formRef\", React.createRef());\n\n    _defineProperty(_assertThisInitialized(_this), \"getData\", function () {\n      _this.setState({\n        loading: true\n      });\n\n      get(_this.props.router.query.id).then(function (r) {\n        return _this.setState({\n          queue: r.queue\n        });\n      })[\"finally\"](function () {\n        return _this.setState({\n          loading: false,\n          refresh: moment.now() + 30 * 1000\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"update\", function () {\n      var forms = [{\n        key: 'max',\n        name: '同时登岛人数',\n        children: __jsx(_InputNumber, {\n          max: 7,\n          min: 1,\n          placeholder: \"\\u4E0D\\u5305\\u62EC\\u81EA\\u5DF1\"\n        }),\n        initial: _this.state.queue.max\n      }, {\n        key: 'password',\n        name: '登岛密码',\n        children: __jsx(_Input, {\n          placeholder: \"\\u767B\\u5C9B\\u5BC6\\u7801(\\u65E0\\u5BC6\\u7801\\u7559\\u7A7A)\"\n        }),\n        initial: _this.state.queue.password\n      }, {\n        key: 'description',\n        name: '描述',\n        children: __jsx(TextArea, {\n          autoSize: {\n            minRows: 5\n          }\n        }),\n        initial: _this.state.queue.description\n      }];\n      var initialValues = Object.assign.apply(Object, [{}].concat(_toConsumableArray(forms.map(function (item) {\n        return _defineProperty({}, item.key, item.initial);\n      }))));\n\n      _Modal.confirm({\n        title: '编辑信息',\n        okText: '修改信息',\n        cancelText: '取消修改',\n        content: __jsx(_Form, {\n          ref: _this.formRef,\n          initialValues: initialValues,\n          labelCol: {\n            span: 4\n          },\n          wrapperCol: {\n            span: 20\n          }\n        }, forms.map(function (item) {\n          return __jsx(_Form.Item, {\n            key: item.key,\n            name: item.key,\n            label: item.name\n          }, item.children);\n        })),\n        okButtonProps: {\n          loading: _this.state.formLoading\n        },\n        onOk: function () {\n          var _onOk = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n            var _this$formRef$current, max, password, description, r;\n\n            return _regeneratorRuntime.wrap(function _callee$(_context) {\n              while (1) {\n                switch (_context.prev = _context.next) {\n                  case 0:\n                    _this.setState({\n                      formLoading: true\n                    });\n\n                    _this$formRef$current = _this.formRef.current.getFieldsValue(true), max = _this$formRef$current.max, password = _this$formRef$current.password, description = _this$formRef$current.description;\n                    _context.next = 4;\n                    return update(_this.props.queue.id, max, password, description);\n\n                  case 4:\n                    r = _context.sent;\n\n                    _this.setState({\n                      formLoading: false\n                    });\n\n                    if (!ShowNotification(r)) {\n                      _context.next = 10;\n                      break;\n                    }\n\n                    _this.getData();\n\n                    _context.next = 11;\n                    break;\n\n                  case 10:\n                    return _context.abrupt(\"return\", Promise.reject());\n\n                  case 11:\n                  case \"end\":\n                    return _context.stop();\n                }\n              }\n            }, _callee);\n          }));\n\n          function onOk() {\n            return _onOk.apply(this, arguments);\n          }\n\n          return onOk;\n        }()\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"insert\", function () {\n      _this.setState({\n        opLoading: true\n      });\n\n      insert(_this.props.queue.id).then(function (r) {\n        ShowNotification(r);\n\n        _this.getData();\n\n        H5Notification('入队成功，请密切关注队伍更新状态');\n      })[\"finally\"](function () {\n        return _this.setState({\n          opLoading: false\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"land\", function (memberID) {\n      _this.setState({\n        opLoading: true\n      });\n\n      land(_this.props.queue.id, memberID).then(function (r) {\n        ShowNotification(r);\n\n        _this.getData();\n      })[\"finally\"](function () {\n        return _this.setState({\n          opLoading: false\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"out\", function (memberID) {\n      _this.setState({\n        opLoading: true\n      });\n\n      out(_this.props.queue.id, memberID).then(function (r) {\n        ShowNotification(r);\n\n        _this.getData();\n      })[\"finally\"](function () {\n        return _this.setState({\n          opLoading: false\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onPageChange\", function (pagination) {\n      var current = pagination.current,\n          pageSize = pagination.pageSize;\n      if (typeof current === 'undefined') current = _this.state.page;\n      if (typeof pageSize === 'undefined') pageSize = _this.state.size;\n\n      _this.setState({\n        page: current,\n        size: pageSize\n      }, _this.getData);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderHeader\", function () {\n      return __jsx(_PageHeader, {\n        title: \"\\u52A8\\u68EE\\u5019\\u673A\\u5927\\u5385\",\n        subTitle: \"\\u524D\\u5F80 \".concat(_this.props.queue.leader.ac_island, \"\\u5C9B(\").concat(_this.props.queue.leader.ac_name, \")\")\n      }, __jsx(_Typography.Paragraph, null, \"\\u4F7F\\u7528\\u8BE5\\u7CFB\\u7EDF\\u9700\\u8981\\u6CE8\\u518C\\u8D26\\u53F7\\uFF0C\\u5E76\\u586B\\u5199 Nintendo \\u8D26\\u53F7\\u540D\\u3001ID\\uFF0C\\u52A8\\u68EE\\u540D\\u79F0\\u3001\\u5C9B\\u540D\\uFF0CQQ \\u53F7\\u4EE5\\u53CA\\u7ED1\\u5B9A QQ \\u4E00\\u952E\\u767B\\u5F55\"), __jsx(_Typography.Paragraph, null, \"QQ \\u53F7\\u5C06\\u4E8E\\u7528\\u4E8E QQ \\u673A\\u5668\\u4EBA\\u63D0\\u9192\\uFF08\\u9700\\u8981\\u548C QQ \\u673A\\u5668\\u4EBA\\u4E3A\\u597D\\u53CB\\u5173\\u7CFB\\uFF0C\\u6216\\u5728\\u540C\\u4E00\\u4E2A\\u7FA4\\u5185\\uFF0C\\u53EF\\u52A0\\u7FA4\\uFF1A797585867\\uFF09\"), __jsx(_Typography.Paragraph, null, \"\\u591A\\u8D9F\\u4E70\\u5356\\u5927\\u5934\\u83DC\\uFF0C\\u8BF7\\u591A\\u6B21\\u6392\\u961F\\uFF0C\\u4EE5\\u63D0\\u5347\\u6548\\u7387\\uFF08\\u4E70\\u5B8C\\u76F4\\u63A5\\u51CF\\u53F7\\u952E\\u56DE\\u5BB6\\uFF0C\\u5355\\u4EBA\\u4E0A\\u5C9B\\uFF0C\\u6548\\u7387\\u66F4\\u9AD8\\uFF09\"), __jsx(_Typography.Paragraph, null, \"\\u5F53\\u8F6E\\u5230\\u4F60\\u767B\\u673A\\u8D77\\u98DE\\u65F6\\uFF0C\\u8BF7\\u5C3D\\u5FEB\\u8D77\\u98DE\\u3002\\u843D\\u5730\\u3001\\u56DE\\u5BB6\\u540E\\u8BF7\\u53CA\\u65F6\\u6309\\u4E0B\\u76F8\\u5173\\u6309\\u94AE\\u3002\\u5982\\u679C\\u591A\\u6B21\\u5728\\u72B6\\u6001\\u66F4\\u65B0\\u540E\\u672A\\u6309\\u4E0B\\u6309\\u94AE\\u4FEE\\u6539\\u72B6\\u6001\\uFF0C\\u5C06\\u4F1A\\u88AB\\u7CFB\\u7EDF\\u62C9\\u9ED1\\uFF0C\\u65E0\\u6CD5\\u4F7F\\u7528\\u8BE5\\u7CFB\\u7EDF\\u3002\"), __jsx(_Typography.Paragraph, null, \"\\u4E3A\\u4E86\\u907F\\u514D\\u70B8\\u5C9B\\uFF0C\\u8054\\u673A\\u6E38\\u620F\\u8BF7\\u5C3D\\u53EF\\u80FD\\u4F7F\\u7528\\u6D41\\u91CF\\u5F00\\u70ED\\u70B9\\u5E76\\u5F00\\u542F\", __jsx(\"a\", {\n        href: \"https://lingti.paiyou.co/signup?c=ir9bam\",\n        target: \"_blank\"\n      }, \"\\u52A0\\u901F\\u5668\"), \"\\uFF08\\u90E8\\u5206\\u52A0\\u901F\\u5668\\u52A0\\u901F\\u540E\\u66F4\\u6162\\uFF0C\\u8BF7\\u4E0D\\u8981\\u7528\\uFF09\"), __jsx(_Typography.Paragraph, null, \"\\u5982\\u679C\\u5BCC\\u88D5\\uFF0C\\u8BF7\\u7ED9\\u5C9B\\u6C11\\u4EE3\\u8868\\u7559\\u4E0B\\u793C\\u7269\\u3002\\u4E0D\\u8981\\u4E71\\u52A8\\u5C9B\\u6C11\\u4EE3\\u8868\\u7684\\u4E1C\\u897F\\uFF0C\\u8BF7\\u4E25\\u683C\\u9075\\u5B88\\u5C9B\\u6C11\\u4EE3\\u8868\\u7684\\u8981\\u6C42\"));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderInfo\", function () {\n      return __jsx(Space, null, __jsx(_Descriptions, {\n        title: \"\\u5019\\u673A\\u5385\\u4FE1\\u606F\",\n        bordered: true\n      }, __jsx(_Descriptions.Item, {\n        label: \"\\u5C9B\\u5C7F\\u540D\\u79F0\"\n      }, _this.state.queue.leader.ac_island, \"\\u5C9B\"), __jsx(_Descriptions.Item, {\n        label: \"\\u5C9B\\u6C11\\u4EE3\\u8868\"\n      }, __jsx(_Popover, {\n        title: \"\\u4E2A\\u4EBA\\u4FE1\\u606F\",\n        content: __jsx(_Descriptions, {\n          size: \"small\",\n          column: 2,\n          bordered: true\n        }, __jsx(_Descriptions.Item, {\n          label: \"\\u5C9B\\u5C7F\\u540D\\u79F0\"\n        }, _this.state.queue.leader.ac_island, \"\\u5C9B\"), __jsx(_Descriptions.Item, {\n          label: \"\\u5C9B\\u6C11\\u4EE3\\u8868\"\n        }, _this.state.queue.leader.ac_name), __jsx(_Descriptions.Item, {\n          label: \"Nintendo Switch ID\"\n        }, \"SW-\", _this.state.queue.leader.ns_id), __jsx(_Descriptions.Item, {\n          label: \"Nintendo Switch \\u7528\\u6237\\u540D\"\n        }, _this.state.queue.leader.ns_name))\n      }, __jsx(\"span\", null, __jsx(Link, {\n        href: \"/user/[username]\",\n        as: \"/user/\".concat(_this.state.queue.leader.username)\n      }, __jsx(\"a\", {\n        target: \"_blank\"\n      }, _this.state.queue.leader.ac_name))))), __jsx(_Descriptions.Item, {\n        label: \"\\u6700\\u5927\\u540C\\u65F6\\u4E0A\\u5C9B\\u4EBA\\u6570\\u9650\\u5236\"\n      }, _this.state.queue.max), __jsx(_Descriptions.Item, {\n        label: \"\\u63CF\\u8FF0\\u4FE1\\u606F\",\n        style: {\n          whiteSpace: 'pre'\n        }\n      }, _this.state.queue.description)), __jsx(If, {\n        condition: _this.context.user.id == _this.props.queue.leader.id || (_this.context.user.permission & 1) === 1\n      }, __jsx(Space, {\n        direction: \"horizontal\",\n        flexCenter: true\n      }, __jsx(_Button, {\n        onClick: _this.update\n      }, \"\\u7F16\\u8F91\\u4FE1\\u606F\"), __jsx(_Popconfirm, {\n        title: \"\\u786E\\u5B9A\\u8981\\u5173\\u95ED\\u673A\\u573A\\uFF1F\\u5173\\u95ED\\u673A\\u573A\\u540E\\u8BE5\\u961F\\u4F0D\\u4E0D\\u5728\\u4F1A\\u4EA7\\u751F\\u53D8\\u52A8\\uFF0C\\u4E14\\u9664\\u8054\\u7CFB\\u7BA1\\u7406\\u5458\\u5916\\uFF0C\\u65E0\\u6CD5\\u6062\\u590D\\u3002\",\n        onConfirm: /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n          var r;\n          return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  _context2.next = 2;\n                  return finish(_this.props.router.query.id);\n\n                case 2:\n                  r = _context2.sent;\n                  ShowNotification(r);\n\n                case 4:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, _callee2);\n        })),\n        okText: \"\\u5173\\u95ED\\uFF01\",\n        cancelText: \"\\u7B97\\u4E86\"\n      }, __jsx(_Button, {\n        danger: true\n      }, \"\\u5173\\u95ED\\u673A\\u573A\")))));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderTable\", function () {\n      var keys = [{\n        key: 'in_time',\n        name: '排队中',\n        color: 'gold',\n        time: '入队时间'\n      }, {\n        key: 'land_time',\n        name: '已着陆',\n        color: 'green',\n        time: '着陆时间'\n      }, {\n        key: 'out_time',\n        name: '已出队',\n        color: 'red',\n        time: '返回时间'\n      }];\n      var columns = [{\n        title: '玩家信息',\n        key: 'username',\n        width: 200,\n        ellipsis: true,\n        render: function render(_, record) {\n          return __jsx(Link, {\n            href: \"/user/[username]\",\n            as: \"/user/\".concat(record.user.username)\n          }, __jsx(\"a\", {\n            target: \"_blank\"\n          }, record.user.ac_island, \"\\u5C9B - \", record.user.ac_name));\n        }\n      }, {\n        title: '入队时间',\n        key: 'in_time',\n        sorter: function sorter(a, b) {\n          return a.in_time - b.in_time;\n        },\n        defaultSortOrder: 'ascend',\n        width: 200,\n        ellipsis: true,\n        render: function render(_, record) {\n          var time = moment(record.in_time, 'X');\n          return __jsx(_Tooltip, {\n            title: time.format('YYYY-MM-DD HH:mm:ss')\n          }, __jsx(\"span\", null, time.fromNow()));\n        }\n      }, {\n        title: '状态',\n        key: 'status',\n        width: 200,\n        ellipsis: true,\n        filters: keys.map(function (item) {\n          return {\n            text: item.name,\n            value: item.key\n          };\n        }),\n        defaultFilteredValue: ['in_time', 'land_time'],\n        onFilter: function onFilter(value, record) {\n          switch (value) {\n            case 'in_time':\n              return record.in_time != 0 && record.land_time == 0 && record.out_time == 0;\n\n            case 'land_time':\n              return record.in_time != 0 && record.land_time != 0 && record.out_time == 0;\n\n            case 'out_time':\n              return record.out_time != 0;\n\n            default:\n              return false;\n          }\n        },\n        render: function render(_, record) {\n          var res = __jsx(_Tag, null, \"\\u672A\\u77E5\\u72B6\\u6001\");\n\n          for (var i = 0; i < keys.length; i++) {\n            if (record[keys[i].key] !== 0) {\n              res = __jsx(_Tag, {\n                color: keys[i].color\n              }, keys[i].name);\n            }\n          }\n\n          return res;\n        }\n      }];\n\n      if ((_this.context.user.permission & 1) === 1 || _this.context.user.id === _this.props.queue.leader.id) {\n        columns.push({\n          title: '操作',\n          key: 'op',\n          ellipsis: true,\n          render: function render(_, record) {\n            return __jsx(_Popconfirm, {\n              title: \"\\u786E\\u8BA4\\u5F3A\\u5236\\u51FA\\u961F\\uFF1F\",\n              onConfirm: function onConfirm() {\n                return _this.out(record.id);\n              }\n            }, __jsx(_Button, {\n              danger: true\n            }, \"\\u5F3A\\u5236\\u51FA\\u961F\"));\n          }\n        });\n      }\n\n      var doingQueue = _this.state.queue.queue.filter(function (item) {\n        return item.out_time === 0;\n      });\n\n      var waitingQueue = _this.state.queue.queue.filter(function (item) {\n        return item.out_time === 0 && item.land_time === 0;\n      });\n\n      var memberID = '';\n      var status = 2;\n\n      if (!_this.context.user.existed) {\n        status = 0;\n      } else if (_this.context.user.qq_connected == false || _this.context.user.ns_id == '' || _this.context.user.ns_name == '' || _this.context.user.ac_name == '' || _this.context.user.ac_island == '') {\n        status = 1;\n      } else {\n        for (var i = 0; i < doingQueue.length; i++) {\n          if (doingQueue[i].user.id === _this.context.user.id) {\n            memberID = doingQueue[i].id;\n\n            for (var j = 0; j < keys.length; j++) {\n              if (doingQueue[i][keys[j].key] === 0) {\n                status = 2 + j;\n                break;\n              }\n            }\n\n            break;\n          }\n        }\n      }\n\n      return __jsx(Space, {\n        size: \"middle\"\n      }, waitingQueue.length > 0 ? __jsx(_Alert, {\n        showIcon: true,\n        message: __jsx(\"span\", null, \"\\u8BF7\", ' ', __jsx(_Typography.Text, {\n          strong: true\n        }, waitingQueue[0].user.ac_island, \"\\u5C9B\\u7684\", waitingQueue[0].user.ac_name), ' ', \"\\u51C6\\u5907\\u53D1\\u5C04\\uFF01\\u5DF2\\u670D\\u52A1\", ' ', __jsx(_Typography.Text, {\n          strong: true\n        }, _this.state.queue.queue.length - waitingQueue.length), ' ', \"\\u540D\\u4E58\\u5BA2\\uFF0C\\u8FD8\\u6709 \", __jsx(_Typography.Text, {\n          strong: true\n        }, waitingQueue.length), ' ', \"\\u540D\\u4E58\\u5BA2\\u5728\\u7B49\\u5F85\"),\n        type: \"info\"\n      }) : doingQueue.length > 0 ? __jsx(_Alert, {\n        showIcon: true,\n        message: __jsx(\"span\", null, __jsx(_Typography.Text, {\n          strong: true\n        }, doingQueue[0].user.ac_island, \"\\u5C9B\\u7684\", doingQueue[0].user.ac_name), ' ', \"\\u6B63\\u5728\\u64CD\\u4F5C\\uFF01\\u5DF2\\u670D\\u52A1\", ' ', __jsx(_Typography.Text, {\n          strong: true\n        }, _this.state.queue.queue.length), \" \\u540D\\u4E58\\u5BA2\"),\n        type: \"info\"\n      }) : __jsx(_Alert, {\n        showIcon: true,\n        message: \"\\u6240\\u6709\\u4E58\\u5BA2\\u5DF2\\u767B\\u673A\\u843D\\u5730,\\u5171\\u670D\\u52A1\\u4E58\\u5BA2 \".concat(_this.state.queue.queue.length, \" \\u540D\"),\n        type: \"success\"\n      }), __jsx(If, {\n        condition: _this.state.queue.password != '' && waitingQueue.length > 0 && waitingQueue[0].user.id == _this.context.user.id\n      }, __jsx(_Alert, {\n        showIcon: true,\n        message: __jsx(\"span\", null, \"\\u4E0A\\u5C9B\\u5BC6\\u7801\\uFF1A\", __jsx(_Typography.Text, {\n          strong: true\n        }, _this.state.queue.password.toUpperCase()), \"\\uFF0C\\u8BF7\\u5C3D\\u5FEB\\u4E0A\\u5C9B\\uFF01\"),\n        type: \"success\"\n      })), __jsx(TextCenter, null, __jsx(_Statistic.Countdown, {\n        title: _this.state.queue.finish_time === 0 ? '下次自动刷新倒计时' : '已关岛',\n        value: _this.state.queue.finish_time === 0 ? _this.state.refresh : 0,\n        onFinish: _this.state.queue.finish_time === 0 ? _this.getData : function () {},\n        format: \"HH:mm:ss:SSS\"\n      }), __jsx(_Button, {\n        loading: _this.state.loading,\n        onClick: _this.getData\n      }, \"\\u5237\\u65B0\\u6570\\u636E\")), __jsx(Steps, {\n        current: status,\n        size: \"small\"\n      }, __jsx(Steps.Step, {\n        title: \"\\u6CE8\\u518C\\u5E76\\u767B\\u5F55\",\n        icon: __jsx(UserOutlined, null)\n      }, __jsx(TextCenter, null, __jsx(_Button, {\n        type: \"primary\",\n        onClick: function onClick() {\n          return _this.setState({\n            loginModal: true\n          });\n        }\n      }, \"\\u6CE8\\u518C/\\u767B\\u5F55\"))), __jsx(Steps.Step, {\n        title: \"\\u5B8C\\u5584\\u4FE1\\u606F\",\n        icon: __jsx(SolutionOutlined, null)\n      }, __jsx(Space, {\n        textCenter: true\n      }, __jsx(Link, {\n        href: \"/user/[username]\",\n        as: \"/user/\".concat(_this.context.user.username)\n      }, __jsx(\"a\", {\n        target: \"_blank\"\n      }, __jsx(_Button, {\n        type: \"primary\"\n      }, \"\\u5B8C\\u5584\\u4E2A\\u4EBA\\u4FE1\\u606F\"))), __jsx(\"p\", null, \"\\u586B\\u5199\\u5B8C\\u6210\\u540E\\uFF0C\\u4F60\\u9700\\u8981\\u5237\\u65B0\\u5F53\\u524D\\u9875\\u9762\"))), __jsx(Steps.Step, {\n        title: \"\\u672A\\u6392\\u961F\",\n        icon: __jsx(CoffeeOutlined, null)\n      }, __jsx(TextCenter, null, __jsx(_Button, {\n        loading: _this.state.opLoading,\n        onClick: _this.insert\n      }, \"\\u6211\\u8981\\u6392\\u961F\"))), __jsx(Steps.Step, {\n        title: \"\\u6B63\\u5728\\u6392\\u961F\",\n        icon: __jsx(TeamOutlined, null)\n      }, __jsx(Space, {\n        direction: \"horizontal\",\n        flexCenter: true\n      }, __jsx(_Button, {\n        loading: _this.state.opLoading,\n        onClick: function onClick() {\n          return _this.land(memberID);\n        }\n      }, \"\\u6211\\u5DF2\\u964D\\u843D\"), __jsx(_Button, {\n        loading: _this.state.opLoading,\n        onClick: function onClick() {\n          return _this.out(memberID);\n        }\n      }, \"\\u53D6\\u6D88\\u6392\\u961F\"))), __jsx(Steps.Step, {\n        title: \"\\u5DF2\\u7740\\u9646\",\n        icon: __jsx(GlobalOutlined, null)\n      }, __jsx(TextCenter, null, __jsx(_Button, {\n        loading: _this.state.opLoading,\n        onClick: function onClick() {\n          return _this.out(memberID);\n        }\n      }, \"\\u6211\\u5DF2\\u8FD4\\u822A\"))), __jsx(Steps.Step, {\n        title: \"\\u5DF2\\u8FD4\\u822A\",\n        icon: __jsx(CheckOutlined, null)\n      })), __jsx(_Table, {\n        rowKey: function rowKey(record) {\n          return record.id;\n        },\n        dataSource: _this.state.queue.queue,\n        scroll: {\n          x: 'auto'\n        },\n        onChange: _this.onPageChange,\n        loading: _this.state.loading,\n        pagination: {\n          current: _this.state.page,\n          total: _this.state.total,\n          pageSize: _this.state.size,\n          showSizeChanger: true\n        },\n        columns: columns,\n        expandable: {\n          expandedRowRender: function expandedRowRender(record) {\n            return __jsx(_Descriptions, {\n              bordered: true\n            }, keys.map(function (item) {\n              var time = moment(record[item.key], 'X');\n              return __jsx(_Descriptions.Item, {\n                key: item.name,\n                label: item.time\n              }, record[item.key] == 0 ? '未到达该状态' : __jsx(_Tooltip, {\n                title: time.fromNow()\n              }, __jsx(\"span\", null, time.format('YYYY-MM-DD HH:mm:ss'))));\n            }));\n          }\n        }\n      }));\n    });\n\n    _this.state = {\n      loading: false,\n      formLoading: false,\n      total: 0,\n      queue: {\n        id: '',\n        leader: defaultContext.user,\n        password: '',\n        description: '',\n        max: 0,\n        create_time: 0,\n        finish_time: 0,\n        queue: []\n      },\n      all: false,\n      page: 1,\n      size: 10,\n      opLoading: false,\n      refresh: 0,\n      loginModal: false\n    };\n    return _this;\n  }\n\n  _createClass(QueueDetail, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this.getData();\n      this.ws = new WebSocket(\"\".concat(window.location.origin.replace('http', 'ws'), \"/api/notification/ws?name=queue\"));\n\n      this.ws.onmessage = function (msg) {\n        var obj = JSON.parse(msg.data);\n        console.log(obj);\n\n        if (typeof obj.data === 'object' && typeof obj.data.message === 'string') {\n          H5Notification(obj.data.message);\n          ShowNotification({\n            success: true,\n            title: '排队通知',\n            content: obj.data.message\n          });\n\n          _this2.getData();\n        }\n      };\n\n      window.addEventListener('beforeunload', this.componentWillMount);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      if (!!this.ws) this.ws.close();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      return __jsx(Container, null, __jsx(Context.Consumer, null, function (context) {\n        return __jsx(Head, null, __jsx(\"title\", null, \"\\u524D\\u5F80\".concat(_this3.props.queue.leader.ac_island, \"\\u5C9B(\").concat(_this3.props.queue.leader.ac_name, \")|\\u52A8\\u68EE\\u5019\\u673A\\u5927\\u5385|\").concat(context.blog_name)));\n      }), __jsx(Space, null, __jsx(_Card, null, this.renderHeader()), __jsx(_Card, null, this.renderInfo()), __jsx(_Card, null, this.renderTable())), __jsx(LoginModal, {\n        show: this.state.loginModal,\n        onCancel: function onCancel() {\n          return _this3.setState({\n            loginModal: false\n          });\n        },\n        callback: function callback(success) {\n          if (success) _this3.setState({\n            loginModal: false\n          });\n        }\n      }));\n    }\n  }], [{\n    key: \"getInitialProps\",\n    value: function () {\n      var _getInitialProps = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(args) {\n        var r;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return get(args.query.id);\n\n              case 2:\n                r = _context3.sent;\n                return _context3.abrupt(\"return\", {\n                  queue: r.queue\n                });\n\n              case 4:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      function getInitialProps(_x) {\n        return _getInitialProps.apply(this, arguments);\n      }\n\n      return getInitialProps;\n    }()\n  }]);\n\n  return QueueDetail;\n}(React.Component);\n\n_defineProperty(QueueDetail, \"contextType\", Context);\n\nexport default withRouter(QueueDetail);","map":null,"metadata":{},"sourceType":"module"}