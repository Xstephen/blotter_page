{"ast":null,"code":"import \"antd/lib/popover/style/css\";\nimport _Popover from \"antd/lib/popover\";\nimport \"antd/lib/row/style/css\";\nimport _Row from \"antd/lib/row\";\nimport \"antd/lib/col/style/css\";\nimport _Col from \"antd/lib/col\";\nimport \"antd/lib/avatar/style/css\";\nimport _Avatar from \"antd/lib/avatar\";\nimport \"antd/lib/menu/style/css\";\nimport _Menu from \"antd/lib/menu\";\nimport \"antd/lib/modal/style/css\";\nimport _Modal from \"antd/lib/modal\";\nimport \"antd/lib/back-top/style/css\";\nimport _BackTop from \"antd/lib/back-top\";\nimport \"antd/lib/button/style/css\";\nimport _Button from \"antd/lib/button\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport \"antd/lib/layout/style/css\";\nimport _Layout from \"antd/lib/layout\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Fragment } from 'react';\nimport Link from 'next/link';\nimport Head from 'next/head';\nimport { withRouter } from 'next/router';\nimport { Icon } from '@ant-design/compatible';\nvar Footer = _Layout.Footer,\n    Sider = _Layout.Sider,\n    Content = _Layout.Content;\nimport { UserOutlined } from '@ant-design/icons'; // import { FormComponentProps } from 'antd/lib/form';\n\nimport changeTheme from 'next-dynamic-antd-theme';\nimport { layout, logout } from '@/utils/api';\nimport ShowNotification from '@/utils/notification';\nimport { Context, defaultContext } from '@/utils/global';\nimport { setCookie } from '@/utils/storage';\nimport styles from '@/components/layout/layout.less';\nimport FooterRenderer from '@/components/layout/footer';\nimport layer from '@/style/layer.less';\nimport If from '@/components/if';\nimport { LoginModal } from '@/components/login';\n\nvar BasicLayout = /*#__PURE__*/function (_React$Component) {\n  _inherits(BasicLayout, _React$Component);\n\n  var _super = _createSuper(BasicLayout);\n\n  _createClass(BasicLayout, null, [{\n    key: \"getInitialProps\",\n    value: function () {\n      var _getInitialProps = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(args) {\n        var r;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return layout();\n\n              case 2:\n                r = _context.sent;\n                return _context.abrupt(\"return\", r);\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function getInitialProps(_x) {\n        return _getInitialProps.apply(this, arguments);\n      }\n\n      return getInitialProps;\n    }()\n  }]);\n\n  function BasicLayout(props) {\n    var _this;\n\n    _classCallCheck(this, BasicLayout);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"context\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"onCollapse\", function (collapsed, type) {\n      if (type == 'responsive') {\n        _this.setState({\n          collapsed: true\n        });\n      } else {\n        _this.setState({\n          collapsed: collapsed\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onBreakpoint\", function (broken) {\n      _this.context.callback({\n        big_screen: !broken\n      });\n\n      _this.setState(function () {\n        return {\n          collapsed: true\n        };\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onCollapseButtonClick\", function () {\n      return _this.setState(function (state) {\n        return {\n          collapsed: !state.collapsed\n        };\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderLight\", function (props) {\n      return __jsx(\"div\", {\n        className: \"primary-color\",\n        dangerouslySetInnerHTML: {\n          __html: \"\\n   <svg width=\\\"1em\\\" height=\\\"1em\\\" viewBox=\\\"0 0 21 21\\\">\\n      <g fill=\\\"none\\\" fill-rule=\\\"evenodd\\\">\\n        <path\\n          fill=\\\"currentColor\\\"\\n          fill-rule=\\\"nonzero\\\"\\n          d=\\\"M21 10.5l-3 3V18h-4.5l-3 3-3-3H3v-4.5l-3-3 3-3V3h4.5l3-3 3 3H18v4.5z\\\"\\n        ></path>\\n        <circle stroke=\\\"#FFF\\\" stroke-width=\\\"1.5\\\" cx=\\\"10.5\\\" cy=\\\"10.5\\\" r=\\\"4\\\"></circle>\\n      </g>\\n    </svg>\\n        \"\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderDark\", function (props) {\n      return __jsx(\"div\", {\n        className: \"primary-color\",\n        dangerouslySetInnerHTML: {\n          __html: \"\\n   <svg width=\\\"1em\\\" height=\\\"1em\\\" viewBox=\\\"0 0 21 21\\\">\\n      <g fill=\\\"none\\\" fill-rule=\\\"evenodd\\\">\\n        <circle fill=\\\"currentColor\\\" cx=\\\"10.5\\\" cy=\\\"10.5\\\" r=\\\"10.5\\\"></circle>\\n        <path\\n          d=\\\"M13.396 11c0-3.019-1.832-5.584-4.394-6.566A6.427 6.427 0 0111.304 4C15.002 4 18 7.135 18 11c0 3.866-2.998 7-6.698 7A6.42 6.42 0 019 17.566c2.564-.98 4.396-3.545 4.396-6.566z\\\"\\n          fill=\\\"#FFF\\\"\\n          fill-rule=\\\"nonzero\\\"\\n        ></path>\\n      </g>\\n    </svg>\\n        \"\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderCollapseButton\", function () {\n      return __jsx(_Button, {\n        type: \"primary\",\n        shape: \"circle\",\n        size: \"large\",\n        icon: _this.state.collapsed ? __jsx(Icon, {\n          type: \"bars\"\n        }) : __jsx(Icon, {\n          type: \"left\"\n        }),\n        className: \"shadow\",\n        onClick: _this.onCollapseButtonClick,\n        style: {\n          position: 'fixed',\n          left: _this.state.collapsed ? _this.context.big_screen ? 100 : 20 : 220,\n          zIndex: 100,\n          top: 20,\n          transition: 'all 0.2s'\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderBackToTop\", function () {\n      return __jsx(_BackTop, {\n        style: {\n          position: 'fixed',\n          right: '20px',\n          bottom: '60px'\n        }\n      }, __jsx(_Button, {\n        shape: \"circle\",\n        className: \"shadow\",\n        size: \"large\",\n        icon: __jsx(Icon, {\n          type: \"rocket\",\n          theme: \"twoTone\"\n        })\n      }));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderFeedback\", function () {\n      return __jsx(Context.Consumer, null, function (context) {\n        return __jsx(_Button, {\n          shape: \"circle\",\n          size: \"large\",\n          icon: __jsx(Icon, {\n            type: \"message\",\n            theme: \"twoTone\"\n          }),\n          className: \"shadow\",\n          onClick: function onClick() {\n            _Modal.info({\n              title: '反馈Bug！',\n              content: __jsx(\"div\", null, __jsx(\"p\", null, \"\\u6709\\u4E00\\u4E2A\", ' ', __jsx(\"a\", {\n                href: \"https://github.com/OhYee/blotter_page/issues\",\n                target: \"__blank\"\n              }, \"\\u524D\\u7AEF\\u7684Bug\"), \"\\uFF0C\\u5305\\u62EC\\u4F46\\u4E0D\\u9650\\u4E8E\\u9875\\u9762\\u6E32\\u67D3\\u4E0D\\u6B63\\u5E38\"), __jsx(\"p\", null, \"\\u6709\\u4E00\\u4E2A\", ' ', __jsx(\"a\", {\n                href: \"https://github.com/OhYee/blotter/issues\",\n                target: \"__blank\"\n              }, \"\\u540E\\u7AEF\\u7684Bug\"), \"\\uFF0C\\u5305\\u62EC\\u4F46\\u4E0D\\u9650\\u4E8E\\u5404\\u79CD\\u529F\\u80FD\\u6027\\u6545\\u969C\"), __jsx(\"p\", null, \"\\u76F4\\u63A5\\u4F7F\\u7528\", __jsx(\"a\", {\n                href: \"mailto:\".concat(context.email),\n                target: \"__blank\"\n              }, ' ', __jsx(Icon, {\n                type: \"mail\"\n              }), \" \\u90AE\\u4EF6\"), ' ', \"\\u53CD\\u9988bug\"), __jsx(\"p\", null, \"\\u76F4\\u63A5\\u4F7F\\u7528\", __jsx(\"a\", {\n                href: \"//wpa.qq.com/msgrd?v=3&uin=\".concat(context.qq, \"&site=qq&menu=yes\"),\n                target: \"__blank\"\n              }, ' ', __jsx(Icon, {\n                type: \"qq\"\n              }), \" QQ\"), ' ', \"\\u53CD\\u9988bug\"), __jsx(\"p\", null, \"\\u76F4\\u63A5\\u5728\\u8BC4\\u8BBA\\u533A\", __jsx(\"a\", {\n                href: \"/comment\",\n                target: \"__blank\"\n              }, ' ', __jsx(Icon, {\n                type: \"comment\"\n              }), \" \\u8BC4\\u8BBA\\u533A\"), ' ', \"\\u53CD\\u9988bug\"))\n            });\n          },\n          style: {\n            position: 'fixed',\n            right: '20px',\n            bottom: '120px'\n          }\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderChangeTheme\", function () {\n      return __jsx(_Button, {\n        shape: \"circle\",\n        size: \"large\",\n        icon: __jsx(Icon, {\n          component: _this.context.theme == 'default' ? _this.renderDark : _this.renderLight\n        }),\n        className: \"shadow\",\n        onClick: function onClick() {\n          var newTheme = _this.context.theme == 'default' ? 'dark' : 'default';\n\n          _this.context.callback({\n            theme: newTheme\n          }, function () {\n            changeTheme(_this.context.theme);\n          });\n        },\n        style: {\n          position: 'fixed',\n          right: '20px',\n          bottom: '180px'\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onLoginClick\", function () {\n      _this.setState({\n        loginModal: true\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onLogoutClick\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var r;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return logout();\n\n            case 2:\n              r = _context2.sent;\n              ShowNotification(r);\n              setCookie('token', '', 0);\n\n              _this.context.callback({\n                user: defaultContext.user\n              });\n\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"renderMenus\", function (menus, theme) {\n      return __jsx(_Menu, {\n        theme: theme,\n        selectedKeys: [_this.props.router.pathname],\n        mode: \"inline\",\n        inlineIndent: 10\n      }, menus.map(function (item) {\n        return __jsx(_Menu.Item, {\n          key: item.link\n        }, item.link.length > 0 && item.link[0] !== '/' ? __jsx(\"a\", {\n          target: \"_blank\",\n          href: item.link\n        }, item.icon ? __jsx(Icon, {\n          type: item.icon\n        }) : null, __jsx(\"span\", null, \"\\xA0\", item.name)) : __jsx(Link, {\n          href: item.link\n        }, __jsx(\"a\", null, item.icon ? __jsx(Icon, {\n          type: item.icon\n        }) : null, __jsx(\"span\", null, \"\\xA0\", item.name))));\n      }));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderSider\", function () {\n      var theme = _this.context.theme === 'default' ? 'light' : 'dark';\n      return __jsx(Sider, {\n        className: ['shadow', layer.float_layer, styles.sider].join(' '),\n        theme: theme,\n        trigger: null,\n        breakpoint: \"xl\",\n        collapsible: true,\n        collapsed: _this.state.collapsed,\n        onCollapse: _this.onCollapse,\n        collapsedWidth: !_this.context.big_screen ? 0 : 80,\n        onBreakpoint: _this.onBreakpoint\n      }, __jsx(\"div\", {\n        className: [styles.avatar, 'textCenter'].join(' ')\n      }, __jsx(\"img\", {\n        src: _this.context.avatar,\n        width: '100%',\n        height: '100%',\n        style: {\n          background: 'white',\n          borderRadius: '100px',\n          maxWidth: '120px'\n        }\n      })), __jsx(Context.Consumer, null, function (context) {\n        return __jsx(Fragment, null, __jsx(\"div\", {\n          className: [styles.avatar, 'textCenter'].join(' ')\n        }, !context.user.existed ? __jsx(\"a\", {\n          onClick: _this.onLoginClick\n        }, __jsx(_Avatar, {\n          icon: __jsx(UserOutlined, null)\n        })) : __jsx(_Popover, {\n          placement: \"right\",\n          trigger: ['click', 'hover'],\n          title: context.user.username,\n          content: __jsx(\"div\", null, __jsx(_Row, {\n            gutter: [10, 10]\n          }, __jsx(_Col, {\n            span: 12\n          }, __jsx(Link, {\n            href: \"/user/[username]\",\n            as: \"/user/\".concat(context.user.username)\n          }, __jsx(\"a\", null, \"\\u8BBE\\u7F6E\"))), __jsx(_Col, {\n            span: 12\n          }, __jsx(\"a\", {\n            onClick: _this.onLogoutClick\n          }, \"\\u767B\\u51FA\"))), __jsx(If, {\n            condition: (context.user.permission & 1) != 0\n          }, __jsx(_Row, {\n            gutter: 10\n          }, __jsx(_Col, {\n            span: 12\n          }, __jsx(Link, {\n            href: \"/admin\"\n          }, __jsx(\"a\", null, \"\\u7BA1\\u7406\"))))))\n        }, __jsx(\"span\", {\n          style: {\n            cursor: 'pointer'\n          }\n        }, context.user.avatar ? __jsx(_Avatar, {\n          src: context.user.avatar,\n          style: {\n            background: 'unset'\n          }\n        }) : __jsx(_Avatar, {\n          icon: __jsx(UserOutlined, null)\n        })))), _this.renderMenus(context.menus, theme));\n      }));\n    });\n\n    _this.state = {\n      collapsed: true,\n      loginModal: false,\n      password: '',\n      okDisabled: false,\n      feedback: false\n    };\n    return _this;\n  }\n\n  _createClass(BasicLayout, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return __jsx(_Layout, {\n        style: {\n          minHeight: '100%'\n        },\n        className: \"\".concat(this.context.theme)\n      }, __jsx(Context.Consumer, null, function (context) {\n        return __jsx(Head, null, __jsx(\"title\", null, context.blog_name));\n      }), this.renderSider(), __jsx(_Layout, null, __jsx(Content, null, this.state.collapsed ? null : __jsx(\"div\", {\n        className: [styles.dimmed, layer.mask_layer].join(' '),\n        onClick: function onClick(e) {\n          return _this2.setState({\n            collapsed: true\n          });\n        }\n      }), this.renderCollapseButton(), __jsx(\"div\", {\n        className: styles.main_content\n      }, this.props.children), this.renderBackToTop(), this.renderFeedback(), this.renderChangeTheme(), __jsx(LoginModal, {\n        show: this.state.loginModal,\n        onCancel: function onCancel() {\n          return _this2.setState({\n            loginModal: false\n          });\n        },\n        callback: function callback(success) {\n          if (success) _this2.setState({\n            loginModal: false\n          });\n        }\n      })), __jsx(Footer, null, __jsx(FooterRenderer, {\n        beian: this.context.beian,\n        friends: this.context.friends,\n        view: this.context.view,\n        from: this.context.from\n      }))));\n    }\n  }]);\n\n  return BasicLayout;\n}(React.Component);\n\n_defineProperty(BasicLayout, \"contextType\", Context);\n\nexport default withRouter(BasicLayout);","map":null,"metadata":{},"sourceType":"module"}