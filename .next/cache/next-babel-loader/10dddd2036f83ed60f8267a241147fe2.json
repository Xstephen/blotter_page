{"ast":null,"code":"import \"antd/lib/card/style/css\";\nimport _Card from \"antd/lib/card\";\nimport \"antd/lib/radio/style/css\";\nimport _Radio from \"antd/lib/radio\";\nimport \"antd/lib/list/style/css\";\nimport _List from \"antd/lib/list\";\nimport \"antd/lib/row/style/css\";\nimport _Row from \"antd/lib/row\";\nimport \"antd/lib/popconfirm/style/css\";\nimport _Popconfirm from \"antd/lib/popconfirm\";\nimport \"antd/lib/switch/style/css\";\nimport _Switch from \"antd/lib/switch\";\nimport \"antd/lib/date-picker/style/css\";\nimport _DatePicker from \"antd/lib/date-picker\";\nimport \"antd/lib/input-number/style/css\";\nimport _InputNumber from \"antd/lib/input-number\";\nimport \"antd/lib/col/style/css\";\nimport _Col from \"antd/lib/col\";\nimport \"antd/lib/form/style/css\";\nimport _Form from \"antd/lib/form\";\nimport \"antd/lib/input/style/css\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/notification/style/css\";\nimport _notification from \"antd/lib/notification\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport \"antd/lib/button/style/css\";\nimport _Button from \"antd/lib/button\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from 'react';\nimport Head from 'next/head';\nimport Router, { withRouter } from 'next/router';\nimport { Icon } from '@ant-design/compatible';\nimport { FormOutlined, MinusOutlined, PlusOutlined, FileImageOutlined, SaveOutlined, ShrinkOutlined, ArrowsAltOutlined } from '@ant-design/icons';\nimport moment from 'moment';\nimport MediaQuery from 'react-responsive';\nimport { ControlledEditor } from '@monaco-editor/react/lib/';\nimport Container, { Space } from '@/components/container';\nimport TagSearch from '@/components/tag_search';\nimport PostContent from '@/components/post_content';\nimport { waitUntil } from '@/utils/debounce';\nimport { markdown, adminPost, postEdit } from '@/utils/api';\nimport { dimensionMaxMap } from '@/utils/responsive';\nimport styles from '@/pages/post/post.less';\nimport { Context } from '@/utils/global';\nimport ShowNotification from '@/utils/notification';\nimport { setLocalStorage, getLocalStorage, removeLocalStorage } from '@/utils/storage';\nimport Qiniu from '@/components/upload';\n\nfunction Editor(props) {\n  var onChange = props.onChange,\n      getRef = props.getRef,\n      restProps = _objectWithoutProperties(props, [\"onChange\", \"getRef\"]);\n\n  var handleEditorChange = function handleEditorChange(ev, value) {\n    return onChange(value);\n  };\n\n  return __jsx(\"div\", {\n    style: {\n      display: 'flex',\n      width: '100%',\n      height: 'calc(100vh - 20px)',\n      overflow: 'hidden'\n    }\n  }, __jsx(ControlledEditor, _extends({\n    onChange: handleEditorChange\n  }, restProps, {\n    styles: {\n      flex: '1 1 auto'\n    },\n    editorDidMount: function editorDidMount(_, editor) {\n      return getRef(editor);\n    }\n  })));\n}\n\nvar Press = function Press(props) {\n  var initArg = props.initArg,\n      _props$onPressing = props.onPressing,\n      onPressing = _props$onPressing === void 0 ? function () {} : _props$onPressing,\n      _props$ms = props.ms,\n      ms = _props$ms === void 0 ? 500 : _props$ms,\n      restProps = _objectWithoutProperties(props, [\"initArg\", \"onPressing\", \"ms\"]);\n\n  var _React$useState = React.useState(0),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      value = _React$useState2[0],\n      setValue = _React$useState2[1]; //   const [arg, setArg] = React.useState(initArg);\n\n\n  return __jsx(_Button, _extends({}, restProps, {\n    onMouseDown: function onMouseDown(e) {\n      var arg = initArg;\n      clearInterval(value);\n      var interval = setInterval(function () {\n        arg = onPressing(arg);\n      }, ms);\n      setValue(interval);\n    },\n    onMouseUp: function onMouseUp(e) {\n      return clearInterval(value);\n    }\n  }));\n};\n\nvar fieldsName = ['id', 'title', 'url', 'abstract', 'head_image', 'view', 'publish_time', 'edit_time', 'published' //   'raw',\n];\n\nvar PostEdit = /*#__PURE__*/function (_React$Component) {\n  _inherits(PostEdit, _React$Component);\n\n  var _super = _createSuper(PostEdit);\n\n  function PostEdit(props) {\n    var _this;\n\n    _classCallCheck(this, PostEdit);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"formRef\", React.createRef());\n\n    _defineProperty(_assertThisInitialized(_this), \"previewRef\", React.createRef());\n\n    _defineProperty(_assertThisInitialized(_this), \"now\", moment(new Date()));\n\n    _defineProperty(_assertThisInitialized(_this), \"editor\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"ctrlS\", function (e) {\n      var keyCode = e.keyCode || e.which || e.charCode;\n      var ctrlKey = e.ctrlKey || e.metaKey;\n\n      if (ctrlKey && keyCode == 83) {\n        e.preventDefault();\n        e.returnValue = false;\n\n        _this.submit();\n\n        return true;\n      }\n\n      return false;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getData\", /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(url) {\n        var r;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return adminPost(url);\n\n              case 2:\n                r = _context.sent;\n\n                _this.formRef.current.setFieldsValue({\n                  id: r.id,\n                  title: r.title,\n                  url: r.url,\n                  \"abstract\": r[\"abstract\"],\n                  head_image: r.head_image,\n                  view: r.view,\n                  publish_time: moment(new Date(r.publish_time)),\n                  //   edit_time: moment(new Date(r.edit_time)),\n                  published: r.published //   raw: r.raw,\n\n                });\n\n                _this.setState({\n                  tags: r.tags,\n                  html: r.content,\n                  raw: r.raw,\n                  images: !!r.images ? r.images : []\n                }, function () {\n                  console.log('got data', r.raw.length);\n                  if (!!_this.editor) _this.editor.setValue(r.raw);\n                });\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"onBigScreen\", function (match) {\n      _this.setState({\n        bigScreen: match\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderMarkdown\", /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(source) {\n        var r;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _this.setState({\n                  loading: true\n                });\n\n                _context2.next = 3;\n                return markdown(source);\n\n              case 3:\n                r = _context2.sent;\n\n                _this.setState({\n                  html: r.html,\n                  loading: false\n                });\n\n                return _context2.abrupt(\"return\", r.html);\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      return function (_x2) {\n        return _ref2.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"onChange\", function (value) {\n      waitUntil('post_edit_sync', function () {\n        setLocalStorage(\"post-\".concat(_this.props.router.query.url), value);\n\n        if (_this.state.preview) {\n          _this.renderMarkdown(value);\n        }\n      }, 1000);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"tagOnAdd\", function (tag) {\n      _this.setState(function (state) {\n        var tags = state.tags;\n        tags.push(tag);\n        return {\n          tags: tags\n        };\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"tagOnDelete\", function (tag) {\n      _this.setState(function (state) {\n        var tags = state.tags.filter(function (_tag) {\n          return _tag[\"short\"] != tag[\"short\"];\n        });\n        return {\n          tags: tags\n        };\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"syncScroll\", function (top, height) {\n      if (_this.state.preview === 2) {\n        _this.previewRef.current.scrollTop = top / height * _this.previewRef.current.scrollHeight + _this.state.offset;\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getValidInput\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      var obj;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              _context3.next = 3;\n              return _this.formRef.current.validateFields(fieldsName);\n\n            case 3:\n              obj = _context3.sent;\n              _context3.next = 9;\n              break;\n\n            case 6:\n              _context3.prev = 6;\n              _context3.t0 = _context3[\"catch\"](0);\n              throw _context3.t0;\n\n            case 9:\n              obj.tags = _this.state.tags.map(function (tag) {\n                return tag.id;\n              });\n              obj.publish_time = obj.publish_time.unix();\n              obj.edit_time = obj.edit_time.unix();\n              obj.raw = _this.editor.getValue();\n              obj.images = _this.state.images.filter(function (item) {\n                return !!item;\n              });\n              return _context3.abrupt(\"return\", obj);\n\n            case 15:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[0, 6]]);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"getInput\", function () {\n      try {\n        var obj = _this.formRef.current.getFieldsValue(fieldsName);\n      } catch (e) {\n        throw e;\n      }\n\n      obj.tags = _this.state.tags;\n      obj.publish_time = obj.publish_time.format('YYYY-MM-DD HH:mm:ss');\n      obj.edit_time = obj.edit_time.format('YYYY-MM-DD HH:mm:ss');\n      obj.raw = _this.editor.getValue();\n      obj.images = _this.state.images.filter(function (item) {\n        return !!item;\n      });\n      return obj;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"submit\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n      var obj, err;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _this.setState({\n                submitDisabled: true\n              });\n\n              _context4.prev = 1;\n              _context4.next = 4;\n              return _this.getValidInput();\n\n            case 4:\n              obj = _context4.sent;\n              _context4.next = 13;\n              break;\n\n            case 7:\n              _context4.prev = 7;\n              _context4.t0 = _context4[\"catch\"](1);\n              err = _context4.t0.errorFields.map(function (item) {\n                return item.errors.join(' ');\n              }).join('\\n');\n\n              _notification.error({\n                message: '信息错误',\n                description: err\n              });\n\n              _this.setState({\n                submitDisabled: false\n              });\n\n              return _context4.abrupt(\"return\");\n\n            case 13:\n              postEdit(obj).then(function (r) {\n                if (ShowNotification(r)) {\n                  Router.push(\"/admin/post?url=\".concat(obj.url));\n\n                  _this.getData(obj.url);\n\n                  removeLocalStorage(\"post-\".concat(_this.props.router.query.url));\n                }\n              })[\"finally\"](function () {\n                _this.setState({\n                  submitDisabled: false\n                });\n              });\n\n            case 14:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, null, [[1, 7]]);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"importImages\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n      var html, reg, images, result, part, params, key, end, i, tmp;\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.next = 2;\n              return _this.renderMarkdown(_this.editor.getValue());\n\n            case 2:\n              html = _context5.sent;\n              reg = new RegExp('<img ([^>]*)>', 'g');\n              images = [];\n\n              do {\n                result = reg.exec(html);\n\n                if (result !== null) {\n                  part = result[1].split('=');\n                  params = {};\n                  key = '';\n                  end = '';\n\n                  for (i = 0; i < part.length; i++) {\n                    if (key === '') {\n                      key = part[i];\n                      end = part[i + 1][0];\n                    } else {\n                      tmp = part[i].split(end);\n                      params[key] = tmp[1];\n                      key = tmp[2].trim();\n                    }\n                  }\n\n                  if (!!params['src']) {\n                    if (!!params['alt'] || !!params['title']) images.push(\"\".concat(params['src'], \"#\").concat(!!params['title'] ? params['title'] : params['alt']));else images.push(params['src']);\n                  }\n                }\n              } while (result);\n\n              _this.setState({\n                images: images\n              });\n\n            case 7:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"renderEditor\", function () {\n      var opts = {\n        fontSize: _this.state.fontSize,\n        wordWrap: 'on',\n        quickSuggestions: false,\n        acceptSuggestionOnCommitCharacter: false,\n        acceptSuggestionOnEnter: 'off',\n        snippetSuggestions: 'none'\n      };\n      return __jsx(\"div\", {\n        id: \"editor\"\n      }, __jsx(Context.Consumer, null, function (context) {\n        return __jsx(Editor, {\n          language: \"markdown\",\n          theme: context.theme == 'default' ? 'light' : 'dark' //   value={this.state.raw}\n          ,\n          getRef: function getRef(ref) {\n            _this.editor = ref;\n            ref.onDidScrollChange(function (e) {\n              _this.syncScroll(e.scrollTop, e.scrollHeight);\n            }); // monaco.KeyMod.chord(monaco.KeyMod.Alt, monaco.KeyMod.Shift, monaco.KeyCode.KEY_I)\n            // ref.addCommand(67109376, () => {\n            //   console.log('S!');\n            // });\n\n            if (_this.state.raw !== '') ref.setValue(_this.state.raw);\n          },\n          options: opts,\n          onChange: _this.onChange\n        });\n      }));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderPreview\", function () {\n      try {\n        var obj = _this.getInput();\n      } catch (e) {\n        var err = e.errorFields.map(function (item) {\n          return item.errors.join(' ');\n        }).join('\\n');\n\n        _notification.error({\n          message: '信息错误',\n          description: err\n        });\n      }\n\n      var post = _objectSpread(_objectSpread({}, obj), {}, {\n        content: _this.state.html\n      });\n\n      return __jsx(\"div\", null, __jsx(Icon, {\n        type: _this.state.loading ? 'loading' : 'check'\n      }), __jsx(PostContent, {\n        post: post\n      }));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderToolbar\", function () {\n      var md = _this.state.preview === 2;\n      return __jsx(_Row, {\n        gutter: 15\n      }, __jsx(_Col, {\n        lg: 24\n      }, __jsx(_Form.Item, {\n        name: \"id\"\n      }, __jsx(_Input, {\n        disabled: true,\n        placeholder: \"\\u6587\\u7AE0ID\",\n        addonBefore: \"ID\"\n      }))), __jsx(_Col, {\n        lg: md ? 12 : 6,\n        md: 12\n      }, __jsx(_Form.Item, {\n        name: \"url\",\n        rules: [{\n          required: true,\n          message: '文章必须有链接',\n          whitespace: true\n        }]\n      }, __jsx(_Input, {\n        placeholder: \"\\u6587\\u7AE0\\u94FE\\u63A5\",\n        addonBefore: \"/post/\"\n      }))), __jsx(_Col, {\n        lg: md ? 12 : 6,\n        md: 12\n      }, __jsx(_Form.Item, {\n        name: \"view\"\n      }, __jsx(_InputNumber, {\n        placeholder: \"\\u9605\\u8BFB\\u91CF\",\n        min: 0\n      }))), __jsx(_Col, {\n        lg: md ? 12 : 6,\n        md: 12\n      }, __jsx(_Form.Item, {\n        name: \"publish_time\"\n      }, __jsx(_DatePicker, {\n        showTime: true,\n        placeholder: \"\\u53D1\\u5E03\\u65F6\\u95F4\"\n      }))), __jsx(_Col, {\n        lg: md ? 12 : 6,\n        md: 12\n      }, __jsx(_Form.Item, {\n        name: \"edit_time\"\n      }, __jsx(_DatePicker, {\n        showTime: true,\n        placeholder: \"\\u7F16\\u8F91\\u65F6\\u95F4\"\n      }))), __jsx(_Col, {\n        lg: md ? 12 : 10,\n        md: 12\n      }, __jsx(_Form.Item, {\n        name: \"title\"\n      }, __jsx(_Input, {\n        placeholder: \"\\u6587\\u7AE0\\u6807\\u9898\"\n      }))), __jsx(_Col, {\n        lg: md ? 12 : 8,\n        md: 12\n      }, __jsx(_Form.Item, {\n        name: \"head_image\"\n      }, __jsx(_Input, {\n        placeholder: \"\\u5934\\u56FE\",\n        onChange: function onChange(e) {\n          _this.setState({\n            headImage: e.currentTarget.value\n          });\n        }\n      }))), __jsx(_Col, {\n        lg: md ? 12 : 2,\n        md: 12\n      }, __jsx(_Form.Item, {\n        name: \"published\",\n        valuePropName: \"checked\"\n      }, __jsx(_Switch, {\n        checkedChildren: \"\\u53D1\\u5E03\",\n        unCheckedChildren: \"\\u8349\\u7A3F\"\n      }))), __jsx(_Col, {\n        lg: md ? 12 : 2,\n        md: 12\n      }, __jsx(_Form.Item, null, __jsx(_Button, {\n        onClick: function onClick() {\n          _this.editor.setValue(_this.state.draft);\n        }\n      }, \"\\u672C\\u5730\\u6062\\u590D\"))), __jsx(_Col, {\n        lg: md ? 12 : 2,\n        md: 12\n      }, __jsx(_Form.Item, null, __jsx(_InputNumber, {\n        value: _this.state.fontSize,\n        onChange: function onChange(v) {\n          return _this.setState({\n            fontSize: parseInt(v.toString())\n          }, function () {});\n        }\n      }))), __jsx(_Col, {\n        lg: md ? 12 : 2,\n        md: 12\n      }, __jsx(_Form.Item, null, __jsx(_Button, {\n        onClick: function onClick() {\n          var now = moment(new Date());\n\n          _this.formRef.current.setFieldsValue({\n            publish_time: now,\n            edit_time: now\n          });\n        }\n      }, \"\\u91CD\\u7F6E\\u65E5\\u671F\"))), __jsx(_Col, {\n        lg: md ? 12 : 2,\n        md: 12\n      }, __jsx(_Form.Item, null, __jsx(_Button, {\n        onClick: _this.importImages\n      }, \"\\u5BFC\\u5165\\u56FE\\u7247\"))), __jsx(_Col, {\n        span: 24\n      }, __jsx(_Form.Item, null, __jsx(TagSearch, {\n        onAdd: _this.tagOnAdd,\n        onDelete: _this.tagOnDelete,\n        tags: _this.state.tags\n      }))), __jsx(_Col, {\n        span: 24\n      }, __jsx(_Form.Item, {\n        name: \"abstract\"\n      }, __jsx(_Input.TextArea, {\n        autoSize: {\n          minRows: 5\n        },\n        spellCheck: \"false\",\n        placeholder: \"\\u6587\\u7AE0\\u6458\\u8981\"\n      }))), __jsx(_Col, {\n        span: 24\n      }, __jsx(_List, {\n        style: {\n          maxHeight: '50vh',\n          overflow: 'auto'\n        },\n        size: \"small\",\n        dataSource: _this.state.images,\n        renderItem: function renderItem(image, idx) {\n          return __jsx(_List.Item, {\n            key: idx\n          }, __jsx(_Row, {\n            gutter: [5, 5],\n            className: \"fullWidth\",\n            align: \"middle\"\n          }, __jsx(_Col, null, __jsx(\"strong\", null, idx)), __jsx(_Col, null, __jsx(_Popconfirm, {\n            title: \"\\u786E\\u8BA4\\u5220\\u9664\\uFF1F\",\n            onConfirm: function onConfirm() {\n              return _this.setState(function (state) {\n                return {\n                  images: state.images.filter(function (_, idx2) {\n                    return idx != idx2;\n                  })\n                };\n              });\n            }\n          }, __jsx(_Button, {\n            danger: true\n          }, \"\\u5220\\u9664\"))), __jsx(_Col, {\n            flex: \"1 1 auto\"\n          }, __jsx(_Input, {\n            value: image,\n            onChange: function onChange(e) {\n              var value = e.target.value;\n\n              _this.setState(function (state) {\n                var images = state.images;\n                images[idx] = value;\n                return {\n                  images: images\n                };\n              });\n            }\n          })), __jsx(_Col, null, __jsx(\"img\", {\n            src: image,\n            style: {\n              maxHeight: '100px'\n            }\n          }))));\n        }\n      }), __jsx(_Row, {\n        justify: \"end\"\n      }, __jsx(_Col, null, __jsx(_Button, {\n        onClick: function onClick() {\n          return _this.setState(function (state) {\n            var images = state.images;\n            images.push('');\n            return {\n              images: images\n            };\n          });\n        }\n      }, \"\\u65B0\\u5EFA\\u4E00\\u4E2A\\u56FE\\u7247\")))));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderOffset\", function () {\n      var diff = 10;\n\n      var scroll = function scroll(diff) {\n        _this.setState(function (state) {\n          return {\n            offset: state.offset + diff\n          };\n        }, function () {\n          if (!!_this.editor) _this.syncScroll(_this.editor.getScrollTop(), _this.editor.getScrollHeight());\n        });\n      };\n\n      return __jsx(_Button.Group, null, __jsx(Press, {\n        size: \"small\",\n        initArg: -diff,\n        onClick: function onClick() {\n          return scroll(-diff);\n        },\n        onPressing: function onPressing(arg) {\n          scroll(arg - diff);\n          return arg - diff;\n        },\n        ms: 100,\n        icon: __jsx(MinusOutlined, null)\n      }), __jsx(Press, {\n        size: \"small\",\n        initArg: diff,\n        onClick: function onClick() {\n          return scroll(diff);\n        },\n        onPressing: function onPressing(arg) {\n          scroll(arg + diff);\n          return arg + diff;\n        },\n        ms: 100,\n        icon: __jsx(PlusOutlined, null)\n      }));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderImages\", function () {\n      return __jsx(\"div\", null, __jsx(_Button, {\n        shape: \"circle\",\n        danger: _this.state.upload,\n        onClick: function onClick() {\n          return _this.setState(function (state) {\n            return {\n              upload: !state.upload\n            };\n          });\n        },\n        icon: __jsx(FileImageOutlined, null)\n      }), __jsx(\"div\", {\n        className: ['upload', 'shadow'].join(' '),\n        style: _objectSpread({\n          right: 120,\n          top: 180\n        }, _this.state.upload ? {\n          opacity: 1,\n          visibility: 'visible'\n        } : {\n          opacity: 0,\n          visibility: 'hidden'\n        })\n      }, __jsx(Qiniu, {\n        defaultTab: \"upload\"\n      })));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"previewClick\", function (e) {\n      var v = e.target.value;\n\n      _this.setState({\n        preview: v\n      }, function () {\n        if (!!_this.editor) _this.editor.layout();\n\n        _this.renderMarkdown(_this.editor.getValue());\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderPreviewButton\", function () {\n      return __jsx(_Radio.Group, {\n        value: _this.state.preview,\n        buttonStyle: \"solid\",\n        onChange: _this.previewClick,\n        size: \"small\",\n        style: {\n          flexDirection: 'column',\n          display: 'flex'\n        }\n      }, __jsx(_Radio.Button, {\n        value: 0\n      }, \"\\u7F16\\u8F91\"), __jsx(_Radio.Button, {\n        value: 1\n      }, \"\\u9884\\u89C8\"), __jsx(_Radio.Button, {\n        value: 2\n      }, \"\\u53CC\\u680F\"));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderFixedButton\", function () {\n      var items = [_this.renderPreviewButton(), _this.renderOffset(), __jsx(_Button.Group, null, __jsx(_Button, {\n        size: \"small\",\n        icon: __jsx(ShrinkOutlined, {\n          onClick: function onClick() {\n            return _this.editor.trigger('fold', 'editor.foldAll');\n          }\n        })\n      }), __jsx(_Button, {\n        size: \"small\",\n        icon: __jsx(ArrowsAltOutlined, null),\n        onClick: function onClick() {\n          return _this.editor.trigger('unfold', 'editor.unfoldAll');\n        }\n      })), __jsx(_Button, {\n        shape: \"circle\",\n        onClick: function onClick() {\n          var editor = document.getElementById('editor');\n\n          if (!!editor && editor.offsetTop > 0) {\n            scrollTo(0, editor.offsetTop + 10);\n          }\n        },\n        icon: __jsx(FormOutlined, null)\n      }), _this.renderImages(), __jsx(_Button, {\n        loading: _this.state.submitDisabled,\n        onClick: _this.submit,\n        shape: \"circle\",\n        icon: __jsx(SaveOutlined, null),\n        type: \"primary\"\n      })];\n      return __jsx(Space, {\n        size: 15,\n        className: styles.fixed_button\n      }, items.map(function (item, idx) {\n        return __jsx(\"div\", {\n          key: idx\n        }, item);\n      }));\n    });\n\n    _this.state = {\n      raw: '',\n      html: '',\n      preview: 0,\n      bigScreen: true,\n      loading: false,\n      tags: [],\n      headImage: '',\n      submitDisabled: false,\n      draft: '',\n      offset: 0,\n      fontSize: 16,\n      images: [],\n      upload: false\n    };\n    return _this;\n  }\n\n  _createClass(PostEdit, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var url = this.props.router.query.url;\n      var value = getLocalStorage(\"post-\".concat(url));\n      this.setState({\n        draft: value\n      });\n\n      if (url != '' && typeof url != 'undefined') {\n        this.getData(url);\n      }\n\n      document.addEventListener('keydown', this.ctrlS);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      document.removeEventListener('keydown', this.ctrlS);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return __jsx(Container, {\n        xxl: 20,\n        xl: 20,\n        lg: 20,\n        md: 24,\n        sm: 24,\n        xs: 24\n      }, __jsx(Context.Consumer, null, function (context) {\n        return __jsx(Head, null, __jsx(\"title\", null, \"\\u6587\\u7AE0\\u7F16\\u8F91|\\u540E\\u53F0|\".concat(context.blog_name)));\n      }), __jsx(MediaQuery, {\n        minDeviceWidth: dimensionMaxMap.lg,\n        onChange: this.onBigScreen\n      }, null), this.renderFixedButton(), __jsx(_Row, {\n        gutter: 5\n      }, __jsx(_Col, {\n        span: this.state.preview == 2 ? 12 : 24\n      }, __jsx(_Card, null, __jsx(_Form, {\n        ref: this.formRef,\n        initialValues: {\n          id: '',\n          title: '',\n          url: '',\n          \"abstract\": '',\n          head_image: '',\n          view: 0,\n          publish_time: this.now,\n          edit_time: this.now,\n          published: false,\n          raw: ''\n        }\n      }, __jsx(Space, null, this.renderToolbar(), this.state.preview === 1 ? this.renderPreview() : null, __jsx(\"div\", {\n        style: {\n          display: this.state.preview === 1 ? 'none' : 'unset'\n        }\n      }, this.renderEditor()))))), this.state.preview == 2 ? __jsx(_Col, {\n        span: 12\n      }, __jsx(\"div\", {\n        className: styles.preview + ' shadow',\n        ref: this.previewRef\n      }, __jsx(_Card, null, this.renderPreview(), __jsx(\"div\", {\n        style: {\n          height: 'calc(100vh - 20px)'\n        }\n      })))) : null));\n    }\n  }]);\n\n  return PostEdit;\n}(React.Component);\n\n_defineProperty(PostEdit, \"defaultProps\", {});\n\nexport default withRouter(PostEdit);","map":null,"metadata":{},"sourceType":"module"}