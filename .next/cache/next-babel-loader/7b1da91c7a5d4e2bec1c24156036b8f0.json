{"ast":null,"code":"import \"antd/lib/card/style/css\";\nimport _Card from \"antd/lib/card\";\nimport \"antd/lib/table/style/css\";\nimport _Table from \"antd/lib/table\";\nimport \"antd/lib/row/style/css\";\nimport _Row from \"antd/lib/row\";\nimport \"antd/lib/switch/style/css\";\nimport _Switch from \"antd/lib/switch\";\nimport \"antd/lib/col/style/css\";\nimport _Col from \"antd/lib/col\";\nimport \"antd/lib/tooltip/style/css\";\nimport _Tooltip from \"antd/lib/tooltip\";\nimport \"antd/lib/statistic/style/css\";\nimport _Statistic from \"antd/lib/statistic\";\nimport \"antd/lib/form/style/css\";\nimport _Form from \"antd/lib/form\";\nimport \"antd/lib/button/style/css\";\nimport _Button from \"antd/lib/button\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport \"antd/lib/input/style/css\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/input-number/style/css\";\nimport _InputNumber from \"antd/lib/input-number\";\nimport \"antd/lib/page-header/style/css\";\nimport _PageHeader from \"antd/lib/page-header\";\nimport \"antd/lib/typography/style/css\";\nimport _Typography from \"antd/lib/typography\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from 'react';\nimport Head from 'next/head';\nimport Link from 'next/link';\nimport { UserOutlined, SolutionOutlined, CheckOutlined } from '@ant-design/icons';\nimport Container, { Space, TextCenter } from '@/components/container';\nimport Steps from '@/components/steps';\nimport { Context } from '@/utils/global';\nimport { LoginModal } from '@/components/login';\nimport { getAll, create } from '@/extensions/queue/api';\nimport moment from 'moment';\nimport TextArea from 'antd/lib/input/TextArea';\nimport ShowNotification from '@/utils/notification';\n\nvar Queues = /*#__PURE__*/function (_React$Component) {\n  _inherits(Queues, _React$Component);\n\n  var _super = _createSuper(Queues);\n\n  function Queues(props) {\n    var _this;\n\n    _classCallCheck(this, Queues);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"context\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"formRef\", React.createRef());\n\n    _defineProperty(_assertThisInitialized(_this), \"getData\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var r;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return getAll(_this.state.all, 1, 10);\n\n            case 2:\n              r = _context.sent;\n\n              _this.setState({\n                total: r.total,\n                queues: r.queues\n              });\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"onPageChange\", function (pagination) {\n      var current = pagination.current,\n          pageSize = pagination.pageSize;\n      if (typeof current === 'undefined') current = _this.state.page;\n      if (typeof pageSize === 'undefined') pageSize = _this.state.size;\n\n      _this.setState({\n        page: current,\n        size: pageSize\n      }, _this.getData);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onSubmit\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var _this$formRef$current, max, password, description, r;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _this.setState({\n                loading: true\n              });\n\n              _this$formRef$current = _this.formRef.current.getFieldsValue(true), max = _this$formRef$current.max, password = _this$formRef$current.password, description = _this$formRef$current.description;\n              _context2.next = 4;\n              return create(max, password, description);\n\n            case 4:\n              r = _context2.sent;\n\n              if (ShowNotification(r)) {\n                _this.getData();\n              }\n\n              _this.setState({\n                loading: false\n              });\n\n            case 7:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"renderHeader\", function () {\n      return __jsx(_PageHeader, {\n        title: \"\\u52A8\\u68EE\\u5019\\u673A\\u5927\\u5385\",\n        subTitle: \"\\u4F18\\u79C0\\u7684\\u4E0A\\u5C9B\\u6392\\u961F\\u5DE5\\u5177\"\n      }, __jsx(_Typography.Paragraph, {\n        strong: true\n      }, \"\\u5EFA\\u7ACB\\u5019\\u673A\\u961F\\u4F0D\\u8BF7\\u4E25\\u683C\\u9075\\u5B88\\u6CD5\\u5F8B\\u6CD5\\u89C4\\uFF01\\u6240\\u6709\\u8FDD\\u89C4\\u5185\\u5BB9\\u5C06\\u88AB\\u63D0\\u4EA4\\u81F3\\u76F8\\u5173\\u90E8\\u95E8\\u3002\\u540C\\u65F6\\u5982\\u679C\\u60A8\\u53D1\\u73B0\\u6709\\u8FDD\\u89C4\\u5185\\u5BB9\\u88AB\\u53D1\\u5E03\\uFF0C\\u4E5F\\u8BF7\\u901A\\u8FC7\\u90AE\\u7BB1\\u3001 QQ \\u7B49\\u65B9\\u5F0F\\u8054\\u7CFB\\u6211\"), __jsx(_Typography.Paragraph, null, \"\\u8981\\u521B\\u5EFA\\u5EFA\\u7ACB\\u81EA\\u5DF1\\u7684\\u5019\\u673A\\u5385\\u4F9B\\u4ED6\\u4EBA\\u767B\\u5C9B\\uFF0C\\u8BF7\\u5148\\u6CE8\\u518C\\u8D26\\u53F7\\uFF0C\\u5E76\\u5B8C\\u5584\\u60A8\\u7684 Nintendo Switch\", ' ', \"\\u4EE5\\u53CA\\u52A8\\u7269\\u68EE\\u53CB\\u4F1A\\u90E8\\u5206\\u8BBE\\u7F6E\"), __jsx(_Typography.Paragraph, null, \"\\u5982\\u679C\\u60F3\\u8981\\u83B7\\u5F97 QQ \\u63D0\\u9192\\u3001\", __jsx(_Typography.Text, {\n        \"delete\": true\n      }, \"\\u5FAE\\u4FE1\\u63D0\\u9192\"), \"\\u3001\", __jsx(_Typography.Text, {\n        \"delete\": true\n      }, \"\\u90AE\\u7BB1\\u63D0\\u9192\"), \"\\uFF0C\\u8BF7\\u7ED1\\u5B9A\\u76F8\\u5173\\u8D26\\u53F7\\u3002 \\u5176\\u4E2D QQ \\u4E00\\u952E\\u767B\\u5F55\\u4EC5\\u7528\\u4E8E\\u5FEB\\u901F\\u767B\\u5F55\\uFF0C\\u4ECD\\u7136\\u9700\\u8981\\u8F93\\u5165\\u60A8\\u7684 QQ \\u53F7\"));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderForm\", function () {\n      var forms = [{\n        key: 'max',\n        name: '同时登岛人数',\n        children: __jsx(_InputNumber, {\n          max: 7,\n          min: 1,\n          placeholder: \"\\u4E0D\\u5305\\u62EC\\u81EA\\u5DF1\"\n        }),\n        initial: 1\n      }, {\n        key: 'password',\n        name: '登岛密码',\n        children: __jsx(_Input, {\n          placeholder: \"\\u767B\\u5C9B\\u5BC6\\u7801(\\u65E0\\u5BC6\\u7801\\u7559\\u7A7A)\"\n        }),\n        initial: ''\n      }, {\n        key: 'description',\n        name: '描述',\n        children: __jsx(TextArea, null),\n        initial: '本岛大头菜 xx 元（非时间旅行），请秩序上岛，不收手续费'\n      }];\n      var initialValues = Object.assign.apply(Object, [{}].concat(_toConsumableArray(forms.map(function (item) {\n        return _defineProperty({}, item.key, item.initial);\n      }))));\n      var status = 2;\n      var help = '';\n\n      if (!_this.context.user.existed) {\n        status = 0;\n        help = '请先登录';\n      } else if (_this.context.user.qq_connected == false || _this.context.user.ns_id == '' || _this.context.user.ns_name == '' || _this.context.user.ac_name == '' || _this.context.user.ac_island == '') {\n        status = 1;\n        help = '请完善您的QQ号、NS账号、动森账号，并绑定 QQ 互联';\n      }\n\n      return __jsx(Space, {\n        size: 50\n      }, __jsx(Steps, {\n        current: status\n      }, __jsx(Steps.Step, {\n        title: \"\\u6CE8\\u518C\\u5E76\\u767B\\u5F55\",\n        icon: __jsx(UserOutlined, null)\n      }, __jsx(TextCenter, null, __jsx(_Button, {\n        type: \"primary\",\n        onClick: function onClick() {\n          return _this.setState({\n            loginModal: true\n          });\n        }\n      }, \"\\u6CE8\\u518C/\\u767B\\u5F55\"))), __jsx(Steps.Step, {\n        title: \"\\u5B8C\\u5584\\u4FE1\\u606F\",\n        icon: __jsx(SolutionOutlined, null)\n      }, __jsx(Space, {\n        textCenter: true\n      }, __jsx(Link, {\n        href: \"/user/[username]\",\n        as: \"/user/\".concat(_this.context.user.username)\n      }, __jsx(\"a\", {\n        target: \"_blank\"\n      }, __jsx(_Button, {\n        type: \"primary\"\n      }, \"\\u5B8C\\u5584\\u4E2A\\u4EBA\\u4FE1\\u606F\"))), __jsx(\"p\", null, \"\\u586B\\u5199\\u5B8C\\u6210\\u540E\\uFF0C\\u4F60\\u9700\\u8981\\u5237\\u65B0\\u5F53\\u524D\\u9875\\u9762\"))), __jsx(Steps.Step, {\n        title: \"\\u5F00\\u59CB\\u4F7F\\u7528\",\n        icon: __jsx(CheckOutlined, null)\n      }, __jsx(_Form, {\n        ref: _this.formRef,\n        initialValues: initialValues,\n        labelCol: {\n          span: 4\n        },\n        wrapperCol: {\n          span: 20\n        }\n      }, forms.map(function (item) {\n        return __jsx(_Form.Item, {\n          key: item.key,\n          name: item.key,\n          label: item.name\n        }, item.children);\n      }), __jsx(_Form.Item, {\n        key: \"submit\",\n        style: {\n          textAlign: 'right'\n        },\n        validateStatus: help == '' ? 'success' : 'error',\n        help: help,\n        labelCol: {\n          span: 0\n        },\n        wrapperCol: {\n          span: 24\n        }\n      }, __jsx(_Button, {\n        disabled: help != '',\n        type: \"primary\",\n        onClick: _this.onSubmit,\n        loading: _this.state.loading\n      }, \"\\u6253\\u5F00\\u673A\\u573A\\u5927\\u95E8\"))))));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderTable\", function () {\n      var columns = [{\n        title: '岛主信息',\n        key: 'username',\n        width: 200,\n        ellipsis: true,\n        render: function render(_, record) {\n          return __jsx(Link, {\n            href: \"/apps/queue/[id]\",\n            as: \"/apps/queue/\".concat(record.id)\n          }, __jsx(\"a\", {\n            target: \"_blank\"\n          }, record.leader.ac_island, \"\\u5C9B - \", record.leader.ac_name));\n        }\n      }, {\n        title: '描述',\n        key: 'description',\n        dataIndex: 'description',\n        // width: 300,\n        // ellipsis: true,\n        render: function render(value) {\n          return __jsx(_Typography.Text, {\n            ellipsis: true,\n            style: {\n              width: 300\n            }\n          }, value);\n        }\n      }, {\n        title: '同时人数',\n        key: 'max',\n        dataIndex: 'max',\n        width: 150,\n        ellipsis: true\n      }, {\n        title: '排队人数',\n        key: 'queue',\n        width: 150,\n        ellipsis: true,\n        render: function render(_, record) {\n          return __jsx(_Statistic, {\n            value: record.queue.filter(function (item) {\n              return item.out_time == 0;\n            }).length,\n            suffix: \"/\".concat(record.queue.length)\n          });\n        }\n      }, {\n        title: '开始时间',\n        key: 'create_time',\n        width: 150,\n        ellipsis: true,\n        render: function render(_, record) {\n          var time = moment(record.create_time, 'X');\n          return __jsx(_Tooltip, {\n            title: time.format('YYYY-MM-DD HH:mm:ss')\n          }, __jsx(\"span\", null, time.fromNow()));\n        }\n      }, {\n        title: '状态',\n        key: 'finish_time',\n        width: 150,\n        ellipsis: true,\n        render: function render(_, record) {\n          var time = moment(record.create_time, 'X');\n          return record.finish_time == 0 ? '进行中' : __jsx(_Tooltip, {\n            title: time.format('YYYY-MM-DD HH:mm:ss')\n          }, __jsx(\"span\", null, time.fromNow()));\n        }\n      }];\n      return __jsx(Space, {\n        size: 20\n      }, __jsx(_Row, {\n        justify: \"end\",\n        gutter: [20, 20]\n      }, __jsx(_Col, null, __jsx(_Button, {\n        onClick: _this.getData\n      }, \"\\u5237\\u65B0\\u6570\\u636E\")), __jsx(_Col, null, __jsx(_Switch, {\n        checkedChildren: \"\\u663E\\u793A\\u6240\\u6709\",\n        unCheckedChildren: \"\\u663E\\u793A\\u8FDB\\u884C\\u4E2D\",\n        checked: _this.state.all,\n        onChange: function onChange(all) {\n          return _this.setState({\n            all: all\n          }, _this.getData);\n        }\n      }))), __jsx(_Table, {\n        rowKey: function rowKey(record) {\n          return record.id;\n        },\n        dataSource: _this.state.queues,\n        scroll: {\n          x: 'auto'\n        },\n        onChange: _this.onPageChange,\n        pagination: {\n          current: _this.state.page,\n          total: _this.state.total,\n          pageSize: _this.state.size,\n          showSizeChanger: true\n        },\n        columns: columns\n      }));\n    });\n\n    _this.state = {\n      loading: false,\n      total: 0,\n      queues: [],\n      all: false,\n      page: 1,\n      size: 10,\n      loginModal: false\n    };\n    return _this;\n  }\n\n  _createClass(Queues, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.getData();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return __jsx(Container, null, __jsx(Context.Consumer, null, function (context) {\n        return __jsx(Head, null, __jsx(\"title\", null, \"\\u52A8\\u68EE\\u5019\\u673A\\u5927\\u5385|\".concat(context.blog_name)));\n      }), __jsx(Space, null, __jsx(_Card, null, this.renderHeader()), __jsx(_Card, null, this.renderForm()), __jsx(_Card, null, this.renderTable())), __jsx(LoginModal, {\n        show: this.state.loginModal,\n        onCancel: function onCancel() {\n          return _this2.setState({\n            loginModal: false\n          });\n        },\n        callback: function callback(success) {\n          if (success) _this2.setState({\n            loginModal: false\n          });\n        }\n      }));\n    }\n  }]);\n\n  return Queues;\n}(React.Component);\n\n_defineProperty(Queues, \"contextType\", Context);\n\n_defineProperty(Queues, \"defaultProps\", {});\n\nexport default Queues;","map":null,"metadata":{},"sourceType":"module"}