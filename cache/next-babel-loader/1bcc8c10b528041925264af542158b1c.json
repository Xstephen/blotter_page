{"ast":null,"code":"import \"antd/lib/back-top/style/css\";\nimport _BackTop from \"antd/lib/back-top\";\nimport \"antd/lib/divider/style/css\";\nimport _Divider from \"antd/lib/divider\";\nimport \"antd/lib/row/style/css\";\nimport _Row from \"antd/lib/row\";\nimport \"antd/lib/modal/style/css\";\nimport _Modal from \"antd/lib/modal\";\nimport \"antd/lib/form/style/css\";\nimport _Form from \"antd/lib/form\";\nimport \"antd/lib/input/style/css\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/menu/style/css\";\nimport _Menu from \"antd/lib/menu\";\nimport \"antd/lib/icon/style/css\";\nimport _Icon from \"antd/lib/icon\";\nimport \"antd/lib/affix/style/css\";\nimport _Affix from \"antd/lib/affix\";\nimport \"antd/lib/button/style/css\";\nimport _Button from \"antd/lib/button\";\nimport _Object$assign from \"@babel/runtime-corejs2/core-js/object/assign\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport \"antd/lib/layout/style/css\";\nimport _Layout from \"antd/lib/layout\";\nvar __jsx = React.createElement;\nimport React from 'react';\nimport Link from 'next/link';\nimport Head from 'next/head';\nimport { withRouter } from 'next/router';\nvar Footer = _Layout.Footer,\n    Sider = _Layout.Sider,\n    Content = _Layout.Content;\nimport Container from '@/components/container';\nimport { layout, login, logout } from '@/utils/api';\nimport ShowNotification from '@/utils/notification';\nimport { Context } from '@/utils/global';\nimport { setCookie } from '@/utils/cookies';\nimport styles from './layout.less';\n\nvar BasicLayout =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(BasicLayout, _React$Component);\n\n  _createClass(BasicLayout, null, [{\n    key: \"getInitialProps\",\n    value: function getInitialProps(args) {\n      var r;\n      return _regeneratorRuntime.async(function getInitialProps$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(layout());\n\n            case 2:\n              r = _context.sent;\n              return _context.abrupt(\"return\", r);\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      });\n    }\n  }]);\n\n  function BasicLayout(props) {\n    var _this;\n\n    _classCallCheck(this, BasicLayout);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(BasicLayout).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"onCollapse\", function (collapsed, type) {\n      if (type == 'responsive') {\n        _this.setState({\n          collapsed: true\n        });\n      } else {\n        _this.setState({\n          collapsed: collapsed\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onBreakpoint\", function (broken) {\n      _this.setState(function () {\n        return {\n          broken: broken\n        };\n      });\n\n      _this.setState(function () {\n        return {\n          collapsed: true\n        };\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onCollapseButtonClick\", function () {\n      return _this.setState(function (state) {\n        return {\n          collapsed: !state.collapsed\n        };\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderCollapseButton\", function () {\n      return __jsx(_Affix, {\n        offsetTop: _this.state.broken ? window.innerHeight - 60 : 20,\n        style: _Object$assign({\n          position: 'fixed',\n          marginLeft: 20,\n          zIndex: 100\n        }, _this.state.broken ? {\n          bottom: 20\n        } : {\n          top: 20\n        })\n      }, __jsx(_Button, {\n        type: \"primary\",\n        shape: \"circle\",\n        size: \"large\",\n        icon: _this.state.collapsed ? 'bars' : 'left',\n        className: \"shadow\",\n        onClick: _this.onCollapseButtonClick\n      }));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onLoginClick\", function () {\n      _this.setState({\n        loginModel: true\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onLogoutClick\", function _callee() {\n      var r;\n      return _regeneratorRuntime.async(function _callee$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return _regeneratorRuntime.awrap(logout());\n\n            case 2:\n              r = _context2.sent;\n\n              if (ShowNotification(r)) {\n                setCookie('token', '', 0);\n              }\n\n              _this.context.callback({\n                token: ''\n              });\n\n            case 5:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"loginOK\", function _callee2() {\n      var _this$props$form$getF, username, password, r;\n\n      return _regeneratorRuntime.async(function _callee2$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _this.setState({\n                okDisabled: true\n              });\n\n              _this$props$form$getF = _this.props.form.getFieldsValue(['username', 'password']), username = _this$props$form$getF.username, password = _this$props$form$getF.password;\n              _context3.next = 4;\n              return _regeneratorRuntime.awrap(login(username, password));\n\n            case 4:\n              r = _context3.sent;\n\n              if (ShowNotification(r)) {\n                _this.context.callback({\n                  token: r.token\n                });\n\n                _this.setState({\n                  loginModel: false,\n                  okDisabled: false\n                });\n              } else {\n                _this.setState({\n                  okDisabled: false\n                });\n              }\n\n            case 6:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"loginCancel\", function () {\n      _this.setState({\n        loginModel: false\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderMenus\", function (menus, token) {\n      return __jsx(_Menu, {\n        theme: \"light\",\n        selectedKeys: [_this.props.router.pathname],\n        mode: \"inline\",\n        inlineIndent: 10\n      }, menus.map(function (item) {\n        return __jsx(_Menu.Item, {\n          key: item.link\n        }, __jsx(Link, {\n          href: item.link\n        }, __jsx(\"a\", null, item.link ? __jsx(_Icon, {\n          type: item.icon\n        }) : null, __jsx(\"span\", null, \"\\xA0\", item.name))));\n      }), token == '' ? __jsx(_Menu.Item, {\n        key: \"login\",\n        onClick: _this.onLoginClick\n      }, __jsx(_Icon, {\n        type: \"login\"\n      }), __jsx(\"span\", null, \"\\u767B\\u5F55\")) : [__jsx(_Menu.Item, {\n        key: \"setting\"\n      }, __jsx(Link, {\n        href: \"/admin\"\n      }, __jsx(\"a\", null, __jsx(_Icon, {\n        type: \"setting\"\n      }), __jsx(\"span\", null, \"\\u540E\\u53F0\")))), __jsx(_Menu.Item, {\n        key: \"logout\",\n        onClick: _this.onLogoutClick\n      }, __jsx(_Icon, {\n        type: \"logout\"\n      }), __jsx(\"span\", null, \"\\u767B\\u51FA\"))], __jsx(_Modal, {\n        title: \"\\u767B\\u5F55\",\n        visible: _this.state.loginModel,\n        onOk: _this.loginOK,\n        onCancel: _this.loginCancel,\n        okButtonProps: {\n          disabled: _this.state.okDisabled\n        }\n      }, __jsx(_Form, null, __jsx(_Form.Item, null, _this.props.form.getFieldDecorator('username')(__jsx(_Input, {\n        prefix: __jsx(_Icon, {\n          type: \"user\",\n          style: {\n            color: 'rgba(0,0,0,.25)'\n          }\n        }),\n        placeholder: \"\\u7528\\u6237\\u540D\"\n      }))), __jsx(_Form.Item, null, _this.props.form.getFieldDecorator(\"password\")(__jsx(_Input.Password, {\n        prefix: __jsx(_Icon, {\n          type: \"lock\",\n          style: {\n            color: 'rgba(0,0,0,.25)'\n          }\n        }),\n        placeholder: \"\\u5BC6\\u7801\",\n        onPressEnter: _this.loginOK\n      }))))));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderSider\", function () {\n      return __jsx(Sider, {\n        theme: \"light\",\n        trigger: null,\n        breakpoint: \"xl\",\n        collapsible: true,\n        collapsed: _this.state.collapsed,\n        onCollapse: _this.onCollapse,\n        collapsedWidth: _this.state.broken ? 0 : 80,\n        onBreakpoint: _this.onBreakpoint\n      }, __jsx(\"div\", {\n        className: styles.sider\n      }, __jsx(_Row, {\n        type: \"flex\",\n        justify: \"center\",\n        className: styles.avatar\n      }, __jsx(\"img\", {\n        src: \"/static/img/logo.svg\",\n        width: '100%',\n        height: '100%',\n        style: {\n          background: 'white',\n          borderRadius: '100px',\n          maxWidth: '120px'\n        }\n      })), __jsx(_Divider, {\n        className: _this.state.collapsed ? styles.divider : undefined\n      }, __jsx(\"b\", {\n        className: styles.divider\n      }, \"OhYee\")), __jsx(Context.Consumer, null, function (context) {\n        return _this.renderMenus(context.menus, context.token);\n      })));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderRSSIcon\", function () {\n      return __jsx(\"svg\", {\n        className: \"icon\",\n        viewBox: \"0 0 1024 1024\",\n        version: \"1.1\",\n        xmlns: \"http://www.w3.org/2000/svg\",\n        \"p-id\": \"1115\",\n        \"data-spm-anchor-id\": \"a313x.7781069.0.i1\"\n      }, __jsx(\"path\", {\n        d: \"M42.666667 853.333333a128 128 0 1 1 256 0 128 128 0 0 1-256 0z m938.666666 128h-178.773333c0-418.986667-340.906667-759.893333-759.893333-759.893333V42.666667c517.546667 0 938.666667 421.12 938.666666 938.666666z m-298.666666 0h-182.826667c0-252.074667-205.098667-457.130667-457.173333-457.130666V341.333333c352.896 0 640 287.104 640 640z\",\n        fill: \"#EE802F\",\n        \"p-id\": \"1116\"\n      }));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderFooter\", function () {\n      return __jsx(Container, null, __jsx(Context.Consumer, null, function (context) {\n        return __jsx(\"div\", {\n          className: styles.footer\n        }, __jsx(\"p\", null, __jsx(\"a\", {\n          href: \"/rss.xml\"\n        }, __jsx(_Icon, {\n          style: {\n            width: '1em'\n          },\n          component: _this.renderRSSIcon\n        }), \"RSS\\u8BA2\\u9605\")), __jsx(\"p\", null, __jsx(_Icon, {\n          type: \"eye\",\n          style: {\n            fontSize: '0.75em'\n          }\n        }), \" \\u5168\\u7AD9\\u8BBF\\u95EE\\u91CF \", context.view), __jsx(\"p\", null, __jsx(\"span\", {\n          className: \"right5\"\n        }, \"2017 \\u2013 \", new Date().getFullYear()), __jsx(\"a\", {\n          href: \"http://beian.miit.gov.cn/\"\n        }, context.beian)), __jsx(\"p\", null, \"Powered by \", __jsx(\"a\", {\n          href: \"https://github.com/OhYee/blotter\"\n        }, \"Blotter\"), \"(Go + React)\"), __jsx(\"p\", null, __jsx(\"span\", {\n          className: \"right5\"\n        }, __jsx(\"a\", {\n          href: \"/sitemap.txt\"\n        }, \"\\u7AD9\\u70B9\\u5730\\u56FE(TXT)\")), __jsx(\"span\", null, __jsx(\"a\", {\n          href: \"/sitemap.xml\"\n        }, \"\\u7AD9\\u70B9\\u5730\\u56FE(XML)\"))), context.friends.length > 0 ? __jsx(\"p\", {\n          className: styles.friends\n        }, __jsx(\"strong\", null, \"\\u53CB\\u60C5\\u94FE\\u63A5\\uFF1A\"), context.friends.map(function (friend) {\n          return __jsx(\"span\", null, __jsx(\"a\", {\n            href: friend.link\n          }, friend.name));\n        })) : null);\n      }));\n    });\n\n    _this.state = {\n      collapsed: true,\n      broken: false,\n      loginModel: false,\n      password: '',\n      okDisabled: false\n    };\n    return _this;\n  }\n\n  _createClass(BasicLayout, [{\n    key: \"render\",\n    value: function render() {\n      return __jsx(_Layout, {\n        style: {\n          minHeight: '100%'\n        },\n        className: this.state.collapsed ? undefined : styles.dimmed\n      }, __jsx(Context.Consumer, null, function (context) {\n        return __jsx(Head, null, __jsx(\"title\", null, context.blog_name));\n      }), __jsx(_Layout, {\n        className: 'shadow',\n        style: {\n          position: 'fixed',\n          zIndex: 100,\n          height: '100vh',\n          overflow: 'auto'\n        }\n      }, this.renderSider(), __jsx(Content, null, this.renderCollapseButton())), __jsx(_Layout, {\n        style: this.state.collapsed ? {} : {}\n      }, __jsx(Content, null, __jsx(\"div\", {\n        className: styles.main_content\n      }, this.props.children), __jsx(_BackTop, null)), __jsx(Footer, null, this.renderFooter())));\n    }\n  }]);\n\n  return BasicLayout;\n}(React.Component);\n\n_defineProperty(BasicLayout, \"contextType\", Context);\n\nexport default _Form.create({\n  name: 'BasicLayout'\n})(withRouter(BasicLayout));","map":null,"metadata":{},"sourceType":"module"}