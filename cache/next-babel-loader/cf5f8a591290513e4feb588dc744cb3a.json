{"ast":null,"code":"import \"antd/lib/card/style/css\";\nimport _Card from \"antd/lib/card\";\nimport \"antd/lib/table/style/css\";\nimport _Table from \"antd/lib/table\";\nimport \"antd/lib/input/style/css\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/alert/style/css\";\nimport _Alert from \"antd/lib/alert\";\nimport \"antd/lib/typography/style/css\";\nimport _Typography from \"antd/lib/typography\";\nimport \"antd/lib/page-header/style/css\";\nimport _PageHeader from \"antd/lib/page-header\";\nimport \"antd/lib/row/style/css\";\nimport _Row from \"antd/lib/row\";\nimport \"antd/lib/popconfirm/style/css\";\nimport _Popconfirm from \"antd/lib/popconfirm\";\nimport \"antd/lib/col/style/css\";\nimport _Col from \"antd/lib/col\";\nimport \"antd/lib/button/style/css\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/tag/style/css\";\nimport _Tag from \"antd/lib/tag\";\nimport \"antd/lib/tooltip/style/css\";\nimport _Tooltip from \"antd/lib/tooltip\";\nvar __jsx = React.createElement;\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React from 'react';\nimport Head from 'next/head';\nimport { withRouter } from 'next/router';\nimport Container from '@/components/container';\nimport { Context } from '@/utils/global';\nimport { request } from '@/utils/request';\nimport moment from 'moment';\nimport ShowNotification from '@/utils/notification';\n\nclass Queue extends React.Component {\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"getData\", async () => {\n      this.setState({\n        loading: true\n      });\n      const r = await request('get', '/api/extensions/queue', {\n        id: this.props.router.query['id']\n      });\n      this.setState({\n        queue: r.queue,\n        loading: false\n      });\n    });\n\n    this.state = {\n      queue: [],\n      value: '',\n      loading: false\n    };\n  }\n\n  componentDidMount() {\n    this.getData();\n    setInterval(this.getData, 20000);\n  }\n\n  render() {\n    const waiting = this.state.queue.filter(item => !item.finish);\n    var columns = [{\n      dataIndex: 'name',\n      title: '乘客信息'\n    }, {\n      title: '候机时间',\n      dataIndex: 'time',\n      sorter: (a, b) => a.time - b.time,\n      render: value => __jsx(_Tooltip, {\n        title: moment(value, 'X').format('YYYY-MM-DD HH:mm:ss')\n      }, __jsx(\"span\", null, moment(value, 'X').fromNow()))\n    }, {\n      title: '状态',\n      dataIndex: 'finish',\n      filters: [{\n        text: '已降落',\n        value: true\n      }, {\n        text: '候机中',\n        value: false\n      }],\n      onFilter: (value, record) => value == record.finish,\n      render: value => value ? __jsx(_Tag, {\n        color: \"green\"\n      }, \"\\u5DF2\\u964D\\u843D\") : __jsx(_Tag, {\n        color: \"red\"\n      }, \"\\u672A\\u767B\\u673A\")\n    }];\n\n    if (this.context.token != '') {\n      columns.push({\n        title: '操作',\n        key: 'op',\n        render: (_, record) => {\n          return __jsx(_Row, {\n            gutter: 10\n          }, __jsx(_Col, null, __jsx(_Button, {\n            size: \"small\",\n            onClick: async e => {\n              this.setState({\n                loading: true\n              });\n              const r = await request('get', '/api/extensions/queue/admin', {\n                _id: record._id,\n                id: record.id,\n                type: record.finish ? 'unfinish' : 'finish'\n              });\n              ShowNotification(r);\n              this.getData();\n            }\n          }, \"\\u4FEE\\u6539\\u72B6\\u6001\")), __jsx(_Col, null, __jsx(_Popconfirm, {\n            title: \"\\u786E\\u5B9A\\u5220\\u9664\\uFF1F\",\n            onConfirm: async e => {\n              this.setState({\n                loading: true\n              });\n              const r = await request('get', '/api/extensions/queue/admin', {\n                _id: record._id,\n                id: record.id,\n                type: 'delete'\n              });\n              ShowNotification(r);\n              this.getData();\n            }\n          }, __jsx(_Button, {\n            size: \"small\"\n          }, \"\\u5220\\u9664\\u8BB0\\u5F55\"))));\n        }\n      });\n    }\n\n    return __jsx(\"div\", null, __jsx(Context.Consumer, null, context => __jsx(Head, null, __jsx(\"title\", null, `${this.props.router.query['id']}|动森候机室|${context.blog_name}`))), __jsx(Container, null, __jsx(_Card, null, __jsx(_PageHeader, {\n      title: \"\\u52A8\\u68EE\\u5019\\u673A\\u5BA4\",\n      subTitle: this.props.router.query['id']\n    }), __jsx(_Alert, {\n      showIcon: true,\n      message: \"\\u767B\\u5C9B\\u89C4\\u8303\",\n      description: __jsx(\"span\", null, __jsx(_Typography.Paragraph, null, \"\\u8F93\\u5165\\u81EA\\u5DF1\\u7684\\u7FA4ID\\u6216\\u8005\\u6E38\\u620FID\\u70B9\\u51FB\\u6211\\u8981\\u6211\\u8981\\u5019\\u673A\\u52A0\\u5165\\u6392\\u961F\\uFF0C\\u6570\\u636E\\u4F1A\\u6BCF20\\u79D2\\u81EA\\u52A8\\u5237\\u65B0\\uFF08\\u4E5F\\u53EF\\u4EE5\\u81EA\\u5DF1\\u624B\\u52A8 F5 \\u5237\\u65B0\\uFF09\"), __jsx(_Typography.Paragraph, null, \"\\u6210\\u529F\\u843D\\u5730\\u540E\\u8BF7\\u70B9\\u51FB\\u201C\\u6211\\u8981\\u964D\\u843D\\u201D\\u5E76\\u5728\\u7FA4\\u91CC@\\u4E0B\\u4E00\\u540D\\u4E58\\u5BA2\\uFF08\\u5982\\u679C\\u662F\\u8981\\u6C42\\u5355\\u4EBA\\u4E0A\\u5C9B\\u5219\\u5728\\u8FD4\\u7A0B\\u540E@\\uFF09\"), __jsx(_Typography.Paragraph, null, \"\\u591A\\u8D9F\\u4E70\\u5356\\u5927\\u5934\\u83DC\\uFF0C\\u8BF7\\u591A\\u6B21\\u6392\\u961F\\uFF0C\\u4EE5\\u63D0\\u5347\\u6548\\u7387\\uFF08\\u7279\\u522B\\u662F\\u4E70\\u5356\\u5927\\u5934\\u83DC\\uFF0C\\u4E70\\u5B8C\\u76F4\\u63A5\\u51CF\\u53F7\\u952E\\u56DE\\u5BB6\\uFF0C\\u5355\\u4EBA\\u4E0A\\u5C9B\\uFF0C\\u6548\\u7387\\u66F4\\u9AD8\\uFF09\"), __jsx(_Typography.Paragraph, null, \"\\u4E3A\\u4E86\\u907F\\u514D\\u70B8\\u5C9B\\uFF0C\\u8054\\u673A\\u6E38\\u620F\\u8BF7\\u5C3D\\u53EF\\u80FD\\u4F7F\\u7528\\u6D41\\u91CF\\u5F00\\u70ED\\u70B9\\u5E76\\u5F00\\u542F\\u52A0\\u901F\\u5668\\uFF08\\u90E8\\u5206\\u52A0\\u901F\\u5668\\u52A0\\u901F\\u540E\\u66F4\\u6162\\uFF0C\\u8BF7\\u4E0D\\u8981\\u7528\\uFF09\"), __jsx(_Typography.Paragraph, null, \"\\u5982\\u679C\\u5BCC\\u88D5\\uFF0C\\u8BF7\\u7ED9\\u5C9B\\u6C11\\u4EE3\\u8868\\u7559\\u4E0B\\u793C\\u7269\\u3002\\u4E0D\\u8981\\u4E71\\u52A8\\u5C9B\\u6C11\\u4EE3\\u8868\\u7684\\u4E1C\\u897F\\u3002\")),\n      type: \"info\"\n    }), __jsx(\"br\", null), waiting.length > 0 ? __jsx(_Alert, {\n      showIcon: true,\n      message: __jsx(\"span\", null, \"\\u8BF7 \", __jsx(_Typography.Text, {\n        strong: true\n      }, waiting[0].name), \" \\u51C6\\u5907\\u53D1\\u5C04\\uFF01 \\u5171\", ' ', __jsx(_Typography.Text, {\n        strong: true\n      }, waiting.length), \" \\u540D\\u4E58\\u5BA2\\u5728\\u7B49\\u5F85\"),\n      type: \"info\"\n    }) : __jsx(_Alert, {\n      showIcon: true,\n      message: `所有乘客已登机落地`,\n      type: \"success\"\n    }), __jsx(_Row, {\n      justify: \"space-between\",\n      style: {\n        margin: 10\n      }\n    }, __jsx(_Col, null, __jsx(_Input, {\n      placeholder: \"\\u4E58\\u5BA2\\u4FE1\\u606F\",\n      value: this.state.value,\n      onChange: e => this.setState({\n        value: e.target.value\n      })\n    })), __jsx(_Col, null, __jsx(_Button, {\n      loading: this.state.loading,\n      onClick: async e => {\n        this.setState({\n          loading: true\n        });\n        const r = await request('get', '/api/extensions/queue/push', {\n          id: this.props.router.query['id'],\n          name: this.state.value\n        });\n        ShowNotification(r);\n        this.getData();\n      }\n    }, \"\\u6211\\u8981\\u5019\\u673A\")), __jsx(_Col, null, __jsx(_Popconfirm, {\n      disabled: waiting.length == 0,\n      title: `确定你已降落，并且你就是当前候机乘客 ${waiting.length && waiting[0].name} ？`,\n      onConfirm: async e => {\n        this.setState({\n          loading: true\n        });\n        const r = await request('get', '/api/extensions/queue/pop', {\n          id: this.props.router.query['id']\n        });\n        ShowNotification(r);\n        this.getData();\n      }\n    }, __jsx(_Button, {\n      disabled: waiting.length == 0,\n      loading: this.state.loading\n    }, \"\\u6211\\u8981\\u964D\\u843D\")))), __jsx(_Table, {\n      rowKey: record => record._id,\n      loading: this.state.loading,\n      dataSource: this.state.queue,\n      columns: columns\n    }))));\n  }\n\n}\n\n_defineProperty(Queue, \"defaultProps\", {\n  posts: []\n});\n\n_defineProperty(Queue, \"contextType\", Context);\n\nexport default withRouter(Queue);","map":null,"metadata":{},"sourceType":"module"}