{"ast":null,"code":"import \"antd/lib/card/style/css\";\nimport _Card from \"antd/lib/card\";\nimport \"antd/lib/table/style/css\";\nimport _Table from \"antd/lib/table\";\nimport \"antd/lib/statistic/style/css\";\nimport _Statistic from \"antd/lib/statistic\";\nimport \"antd/lib/steps/style/css\";\nimport _Steps from \"antd/lib/steps\";\nimport \"antd/lib/alert/style/css\";\nimport _Alert from \"antd/lib/alert\";\nimport \"antd/lib/tag/style/css\";\nimport _Tag from \"antd/lib/tag\";\nimport \"antd/lib/tooltip/style/css\";\nimport _Tooltip from \"antd/lib/tooltip\";\nimport \"antd/lib/space/style/css\";\nimport _Space from \"antd/lib/space\";\nimport \"antd/lib/row/style/css\";\nimport _Row from \"antd/lib/row\";\nimport \"antd/lib/popconfirm/style/css\";\nimport _Popconfirm from \"antd/lib/popconfirm\";\nimport \"antd/lib/col/style/css\";\nimport _Col from \"antd/lib/col\";\nimport \"antd/lib/button/style/css\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/popover/style/css\";\nimport _Popover from \"antd/lib/popover\";\nimport \"antd/lib/descriptions/style/css\";\nimport _Descriptions from \"antd/lib/descriptions\";\nimport \"antd/lib/page-header/style/css\";\nimport _PageHeader from \"antd/lib/page-header\";\nimport \"antd/lib/typography/style/css\";\nimport _Typography from \"antd/lib/typography\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport \"antd/lib/form/style/css\";\nimport _Form from \"antd/lib/form\";\nimport \"antd/lib/modal/style/css\";\nimport _Modal from \"antd/lib/modal\";\nimport _Object$assign from \"@babel/runtime-corejs2/core-js/object/assign\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport \"antd/lib/input/style/css\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/input-number/style/css\";\nimport _InputNumber from \"antd/lib/input-number\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\nimport React from 'react';\nimport Head from 'next/head';\nimport Link from 'next/link';\nimport Container from '@/components/container';\nimport { Context, defaultContext } from '@/utils/global';\nimport { get, finish, update, insert, land, out } from '@/extensions/queue/api';\nimport moment from 'moment';\nimport TextArea from 'antd/lib/input/TextArea';\nimport ShowNotification, { H5Notification } from '@/utils/notification';\nimport { withRouter } from 'next/router';\nimport If from '@/components/if';\n\nvar QueueDetail = /*#__PURE__*/function (_React$Component) {\n  _inherits(QueueDetail, _React$Component);\n\n  function QueueDetail(props) {\n    var _this;\n\n    _classCallCheck(this, QueueDetail);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(QueueDetail).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"context\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"ws\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"formRef\", React.createRef());\n\n    _defineProperty(_assertThisInitialized(_this), \"getData\", function () {\n      _this.setState({\n        loading: true\n      });\n\n      get(_this.props.router.query.id).then(function (r) {\n        return _this.setState({\n          queue: r.queue\n        });\n      })[\"finally\"](function () {\n        return _this.setState({\n          loading: false,\n          refresh: moment.now() + 30 * 1000\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"update\", function () {\n      var forms = [{\n        key: 'max',\n        name: '同时登岛人数',\n        children: __jsx(_InputNumber, {\n          max: 7,\n          min: 1,\n          placeholder: \"\\u4E0D\\u5305\\u62EC\\u81EA\\u5DF1\"\n        }),\n        initial: _this.state.queue.max\n      }, {\n        key: 'password',\n        name: '登岛密码',\n        children: __jsx(_Input, {\n          placeholder: \"\\u767B\\u5C9B\\u5BC6\\u7801(\\u65E0\\u5BC6\\u7801\\u7559\\u7A7A)\"\n        }),\n        initial: _this.state.queue.password\n      }, {\n        key: 'description',\n        name: '描述',\n        children: __jsx(TextArea, null),\n        initial: _this.state.queue.description\n      }];\n\n      var initialValues = _Object$assign.apply(Object, [{}].concat(_toConsumableArray(forms.map(function (item) {\n        return _defineProperty({}, item.key, item.initial);\n      }))));\n\n      _Modal.confirm({\n        title: '编辑信息',\n        okText: '修改信息',\n        cancelText: '取消修改',\n        content: __jsx(_Form, {\n          ref: _this.formRef,\n          initialValues: initialValues,\n          labelCol: {\n            span: 4\n          },\n          wrapperCol: {\n            span: 20\n          }\n        }, forms.map(function (item) {\n          return __jsx(_Form.Item, {\n            key: item.key,\n            name: item.key,\n            label: item.name\n          }, item.children);\n        })),\n        okButtonProps: {\n          loading: _this.state.formLoading\n        },\n        onOk: function onOk() {\n          var _this$formRef$current, max, password, description, r;\n\n          return _regeneratorRuntime.async(function onOk$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _this.setState({\n                    formLoading: true\n                  });\n\n                  _this$formRef$current = _this.formRef.current.getFieldsValue(true), max = _this$formRef$current.max, password = _this$formRef$current.password, description = _this$formRef$current.description;\n                  _context.next = 4;\n                  return _regeneratorRuntime.awrap(update(_this.props.queue.id, max, password, description));\n\n                case 4:\n                  r = _context.sent;\n\n                  _this.setState({\n                    formLoading: false\n                  });\n\n                  if (!ShowNotification(r)) {\n                    _context.next = 10;\n                    break;\n                  }\n\n                  _this.getData();\n\n                  _context.next = 11;\n                  break;\n\n                case 10:\n                  return _context.abrupt(\"return\", _Promise.reject());\n\n                case 11:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, null, null, null, _Promise);\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"insert\", function () {\n      _this.setState({\n        opLoading: true\n      });\n\n      insert(_this.props.queue.id).then(function (r) {\n        ShowNotification(r);\n\n        _this.getData();\n\n        H5Notification('入队成功，请密切关注队伍更新状态');\n      })[\"finally\"](function () {\n        return _this.setState({\n          opLoading: false\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"land\", function (memberID) {\n      _this.setState({\n        opLoading: true\n      });\n\n      land(_this.props.queue.id, memberID).then(function (r) {\n        ShowNotification(r);\n\n        _this.getData();\n      })[\"finally\"](function () {\n        return _this.setState({\n          opLoading: false\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"out\", function (memberID) {\n      _this.setState({\n        opLoading: true\n      });\n\n      out(_this.props.queue.id, memberID).then(function (r) {\n        ShowNotification(r);\n\n        _this.getData();\n      })[\"finally\"](function () {\n        return _this.setState({\n          opLoading: false\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onPageChange\", function (pagination) {\n      var current = pagination.current,\n          pageSize = pagination.pageSize;\n      if (typeof current === 'undefined') current = _this.state.page;\n      if (typeof pageSize === 'undefined') pageSize = _this.state.size;\n\n      _this.setState({\n        page: current,\n        size: pageSize\n      }, _this.getData);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderHeader\", function () {\n      return __jsx(_PageHeader, {\n        title: \"\\u52A8\\u68EE\\u5019\\u673A\\u5927\\u5385\",\n        subTitle: \"\\u524D\\u5F80 \".concat(_this.props.queue.leader.ac_island, \"\\u5C9B(\").concat(_this.props.queue.leader.ac_name, \")\")\n      }, __jsx(_Typography.Paragraph, null, \"\\u8F93\\u5165\\u81EA\\u5DF1\\u7684 \\u7FA4ID \\u6216\\u8005 \\u6E38\\u620FID \\u70B9\\u51FB \\\"\\u6211\\u8981\\u5019\\u673A\\\" \\u52A0\\u5165\\u6392\\u961F\"), __jsx(_Typography.Paragraph, null, \"\\u6210\\u529F\\u843D\\u5730\\u540E\\u8BF7\\u70B9\\u51FB \\\"\\u6211\\u8981\\u964D\\u843D\\\" \\u5E76\\u5728\\u7FA4\\u91CC@\\u4E0B\\u4E00\\u540D\\u4E58\\u5BA2\\uFF08\\u5982\\u679C\\u662F\\u8981\\u6C42\\u5355\\u4EBA\\u4E0A\\u5C9B\\u5219\\u5728\\u8FD4\\u7A0B\\u540E@\\uFF09\"), __jsx(_Typography.Paragraph, null, \"\\u591A\\u8D9F\\u4E70\\u5356\\u5927\\u5934\\u83DC\\uFF0C\\u8BF7\\u591A\\u6B21\\u6392\\u961F\\uFF0C\\u4EE5\\u63D0\\u5347\\u6548\\u7387\\uFF08\\u4E70\\u5B8C\\u76F4\\u63A5\\u51CF\\u53F7\\u952E\\u56DE\\u5BB6\\uFF0C\\u5355\\u4EBA\\u4E0A\\u5C9B\\uFF0C\\u6548\\u7387\\u66F4\\u9AD8\\uFF09\"), __jsx(_Typography.Paragraph, null, \"\\u6570\\u636E\\u4F1A\\u6BCF20\\u79D2\\u81EA\\u52A8\\u5237\\u65B0\\uFF08\\u4E5F\\u53EF\\u4EE5\\u81EA\\u5DF1\\u624B\\u52A8 \\\"\\u5237\\u65B0\\u6570\\u636E\\\"\\uFF09\\uFF0C\\u9ED8\\u8BA4\\u53EA\\u663E\\u793A\\u5019\\u673A\\u4E58\\u5BA2\\uFF0C\\u53EF\\u4EE5\\u81EA\\u884C\\u4FEE\\u6539\\u7B5B\\u9009\\u6761\\u4EF6\\uFF0C\", __jsx(\"a\", {\n        target: \"_blank\",\n        href: \"https://www.oyohyee.com/post/writting_animal_crossing#waiting-area\"\n      }, \"\\u4F7F\\u7528\\u5E2E\\u52A9\")), __jsx(_Typography.Paragraph, null, \"\\u4E3A\\u4E86\\u907F\\u514D\\u70B8\\u5C9B\\uFF0C\\u8054\\u673A\\u6E38\\u620F\\u8BF7\\u5C3D\\u53EF\\u80FD\\u4F7F\\u7528\\u6D41\\u91CF\\u5F00\\u70ED\\u70B9\\u5E76\\u5F00\\u542F\", __jsx(\"a\", {\n        href: \"https://lingti.paiyou.co/signup?c=ir9bam\",\n        target: \"_blank\"\n      }, \"\\u52A0\\u901F\\u5668\"), \"\\uFF08\\u90E8\\u5206\\u52A0\\u901F\\u5668\\u52A0\\u901F\\u540E\\u66F4\\u6162\\uFF0C\\u8BF7\\u4E0D\\u8981\\u7528\\uFF09\"), __jsx(_Typography.Paragraph, null, \"\\u5982\\u679C\\u5BCC\\u88D5\\uFF0C\\u8BF7\\u7ED9\\u5C9B\\u6C11\\u4EE3\\u8868\\u7559\\u4E0B\\u793C\\u7269\\u3002\\u4E0D\\u8981\\u4E71\\u52A8\\u5C9B\\u6C11\\u4EE3\\u8868\\u7684\\u4E1C\\u897F\\u3002\"));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderInfo\", function () {\n      return __jsx(_Space, {\n        direction: \"vertical\",\n        style: {\n          width: '100%'\n        }\n      }, __jsx(_Descriptions, {\n        title: \"\\u5019\\u673A\\u5385\\u4FE1\\u606F\",\n        bordered: true\n      }, __jsx(_Descriptions.Item, {\n        label: \"\\u5C9B\\u5C7F\\u540D\\u79F0\"\n      }, _this.state.queue.leader.ac_island, \"\\u5C9B\"), __jsx(_Descriptions.Item, {\n        label: \"\\u5C9B\\u6C11\\u4EE3\\u8868\"\n      }, __jsx(_Popover, {\n        title: \"\\u4E2A\\u4EBA\\u4FE1\\u606F\",\n        content: __jsx(_Descriptions, {\n          size: \"small\",\n          column: 2,\n          bordered: true\n        }, __jsx(_Descriptions.Item, {\n          label: \"\\u5C9B\\u5C7F\\u540D\\u79F0\"\n        }, _this.state.queue.leader.ac_island, \"\\u5C9B\"), __jsx(_Descriptions.Item, {\n          label: \"\\u5C9B\\u6C11\\u4EE3\\u8868\"\n        }, _this.state.queue.leader.ac_name), __jsx(_Descriptions.Item, {\n          label: \"Nintendo Switch ID\"\n        }, \"SW-\", _this.state.queue.leader.ns_id), __jsx(_Descriptions.Item, {\n          label: \"Nintendo Switch \\u7528\\u6237\\u540D\"\n        }, _this.state.queue.leader.ns_name))\n      }, __jsx(\"span\", null, __jsx(Link, {\n        href: \"/user/[username]\",\n        as: \"/user/\".concat(_this.state.queue.leader.username)\n      }, __jsx(\"a\", {\n        target: \"_blank\"\n      }, _this.state.queue.leader.ac_name))))), __jsx(_Descriptions.Item, {\n        label: \"\\u6700\\u5927\\u540C\\u65F6\\u4E0A\\u5C9B\\u4EBA\\u6570\\u9650\\u5236\"\n      }, _this.state.queue.max), __jsx(_Descriptions.Item, {\n        label: \"\\u63CF\\u8FF0\\u4FE1\\u606F\"\n      }, _this.state.queue.description)), __jsx(If, {\n        condition: _this.context.user.id == _this.props.queue.leader.id\n      }, __jsx(_Row, {\n        justify: \"center\",\n        gutter: [10, 10]\n      }, __jsx(_Col, null, __jsx(_Button, {\n        onClick: _this.update\n      }, \"\\u7F16\\u8F91\\u4FE1\\u606F\")), __jsx(_Col, null, __jsx(_Popconfirm, {\n        title: \"\\u786E\\u5B9A\\u8981\\u5173\\u95ED\\u673A\\u573A\\uFF1F\\u5173\\u95ED\\u673A\\u573A\\u540E\\u8BE5\\u961F\\u4F0D\\u4E0D\\u5728\\u4F1A\\u4EA7\\u751F\\u53D8\\u52A8\\uFF0C\\u4E14\\u9664\\u8054\\u7CFB\\u7BA1\\u7406\\u5458\\u5916\\uFF0C\\u65E0\\u6CD5\\u6062\\u590D\\u3002\",\n        onConfirm: function _callee() {\n          var r;\n          return _regeneratorRuntime.async(function _callee$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  _context2.next = 2;\n                  return _regeneratorRuntime.awrap(finish(_this.props.router.query.id));\n\n                case 2:\n                  r = _context2.sent;\n                  ShowNotification(r);\n\n                case 4:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, null, null, null, _Promise);\n        },\n        okText: \"\\u5173\\u95ED\\uFF01\",\n        cancelText: \"\\u7B97\\u4E86\"\n      }, __jsx(_Button, {\n        type: \"danger\"\n      }, \"\\u5173\\u95ED\\u673A\\u573A\"))))));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderTable\", function () {\n      var keys = [{\n        key: 'in_time',\n        name: '排队中',\n        color: 'gold',\n        time: '入队时间'\n      }, {\n        key: 'land_time',\n        name: '已着陆',\n        color: 'green',\n        time: '着陆时间'\n      }, {\n        key: 'out_time',\n        name: '已出队',\n        color: 'red',\n        time: '返回时间'\n      }];\n      var columns = [{\n        title: '玩家信息',\n        key: 'username',\n        width: 200,\n        ellipsis: true,\n        render: function render(_, record) {\n          return __jsx(Link, {\n            href: \"/user/[username]\",\n            as: \"/user/\".concat(record.user.username)\n          }, __jsx(\"a\", {\n            target: \"_blank\"\n          }, record.user.ac_island, \"\\u5C9B - \", record.user.ac_name));\n        }\n      }, {\n        title: '入队时间',\n        key: 'in_time',\n        sorter: function sorter(a, b) {\n          return a.in_time - b.in_time;\n        },\n        defaultSortOrder: 'ascend',\n        width: 200,\n        ellipsis: true,\n        render: function render(_, record) {\n          var time = moment(record.in_time, 'X');\n          return __jsx(_Tooltip, {\n            title: time.format('YYYY-MM-DD HH:mm:ss')\n          }, __jsx(\"span\", null, time.fromNow()));\n        }\n      }, {\n        title: '状态',\n        key: 'status',\n        width: 200,\n        ellipsis: true,\n        filters: keys.map(function (item) {\n          return {\n            text: item.name,\n            value: item.key\n          };\n        }),\n        defaultFilteredValue: ['in_time', 'land_time'],\n        onFilter: function onFilter(value, record) {\n          switch (value) {\n            case 'in_time':\n              return record.in_time != 0 && record.land_time == 0 && record.out_time == 0;\n\n            case 'land_time':\n              return record.in_time != 0 && record.land_time != 0 && record.out_time == 0;\n\n            case 'out_time':\n              return record.out_time != 0;\n\n            default:\n              return false;\n          }\n        },\n        render: function render(_, record) {\n          var res = __jsx(_Tag, null, \"\\u672A\\u77E5\\u72B6\\u6001\");\n\n          for (var i = 0; i < keys.length; i++) {\n            if (record[keys[i].key] !== 0) {\n              res = __jsx(_Tag, {\n                color: keys[i].color\n              }, keys[i].name);\n            }\n          }\n\n          return res;\n        }\n      }];\n\n      if ((_this.context.user.permission & 1) === 1 || _this.context.user.id === _this.props.queue.leader.id) {\n        columns.push({\n          title: '操作',\n          key: 'op',\n          ellipsis: true,\n          render: function render(_, record) {\n            return __jsx(_Popconfirm, {\n              title: \"\\u786E\\u8BA4\\u5F3A\\u5236\\u51FA\\u961F\\uFF1F\",\n              onConfirm: function onConfirm() {\n                return _this.out(record.id);\n              }\n            }, __jsx(_Button, {\n              type: \"danger\"\n            }, \"\\u5F3A\\u5236\\u51FA\\u961F\"));\n          }\n        });\n      }\n\n      var doingQueue = _this.state.queue.queue.filter(function (item) {\n        return item.out_time === 0;\n      });\n\n      var waitingQueue = _this.state.queue.queue.filter(function (item) {\n        return item.out_time === 0 && item.land_time === 0;\n      });\n\n      var memberID = '';\n      var status = 0;\n\n      for (var i = 0; i < doingQueue.length; i++) {\n        if (doingQueue[i].user.id === _this.context.user.id) {\n          memberID = doingQueue[i].id;\n\n          for (var j = 0; j < keys.length; j++) {\n            if (doingQueue[i][keys[j].key] === 0) {\n              status = j;\n              break;\n            }\n          }\n\n          break;\n        }\n      }\n\n      return __jsx(_Space, {\n        direction: \"vertical\",\n        style: {\n          width: '100%'\n        },\n        size: 20\n      }, waitingQueue.length > 0 ? __jsx(_Alert, {\n        showIcon: true,\n        message: __jsx(\"span\", null, \"\\u8BF7\", ' ', __jsx(_Typography.Text, {\n          strong: true\n        }, waitingQueue[0].user.ac_island, \"\\u5C9B\\u7684\", waitingQueue[0].user.ac_name), ' ', \"\\u51C6\\u5907\\u53D1\\u5C04\\uFF01\\u5DF2\\u670D\\u52A1\", ' ', __jsx(_Typography.Text, {\n          strong: true\n        }, _this.state.queue.queue.length - waitingQueue.length), ' ', \"\\u540D\\u4E58\\u5BA2\\uFF0C\\u8FD8\\u6709 \", __jsx(_Typography.Text, {\n          strong: true\n        }, waitingQueue.length), ' ', \"\\u540D\\u4E58\\u5BA2\\u5728\\u7B49\\u5F85\"),\n        type: \"info\"\n      }) : doingQueue.length > 0 ? __jsx(_Alert, {\n        showIcon: true,\n        message: __jsx(\"span\", null, __jsx(_Typography.Text, {\n          strong: true\n        }, doingQueue[0].user.ac_island, \"\\u5C9B\\u7684\", doingQueue[0].user.ac_name), ' ', \"\\u6B63\\u5728\\u64CD\\u4F5C\\uFF01\\u5DF2\\u670D\\u52A1\", ' ', __jsx(_Typography.Text, {\n          strong: true\n        }, _this.state.queue.queue.length), \" \\u540D\\u4E58\\u5BA2\"),\n        type: \"info\"\n      }) : __jsx(_Alert, {\n        showIcon: true,\n        message: \"\\u6240\\u6709\\u4E58\\u5BA2\\u5DF2\\u767B\\u673A\\u843D\\u5730,\\u5171\\u670D\\u52A1\\u4E58\\u5BA2 \".concat(_this.state.queue.queue.length, \" \\u540D\"),\n        type: \"success\"\n      }), __jsx(If, {\n        condition: _this.state.queue.password != '' && waitingQueue.length > 0 && waitingQueue[0].user.id == _this.context.user.id\n      }, __jsx(_Alert, {\n        showIcon: true,\n        message: __jsx(\"span\", null, \"\\u4E0A\\u5C9B\\u5BC6\\u7801\\uFF1A\", __jsx(_Typography.Text, {\n          strong: true\n        }, _this.state.queue.password), \"\\uFF0C\\u8BF7\\u5C3D\\u5FEB\\u4E0A\\u5C9B\\uFF01\"),\n        type: \"success\"\n      })), __jsx(_Steps, {\n        initial: 0,\n        current: status,\n        size: \"small\"\n      }, __jsx(_Steps.Step, {\n        title: \"\\u672A\\u6392\\u961F\"\n      }), keys.map(function (item) {\n        return __jsx(_Steps.Step, {\n          key: item.key,\n          title: item.name\n        });\n      })), __jsx(_Row, {\n        justify: \"center\"\n      }, __jsx(_Col, null, __jsx(_Statistic.Countdown, {\n        title: \"\\u4E0B\\u6B21\\u81EA\\u52A8\\u5237\\u65B0\\u5012\\u8BA1\\u65F6\",\n        value: _this.state.refresh,\n        onFinish: _this.getData,\n        format: \"HH:mm:ss:SSS\"\n      }))), __jsx(_Row, {\n        justify: \"center\",\n        gutter: [20, 20]\n      }, __jsx(_Col, null, __jsx(_Button, {\n        disabled: !(status == 0),\n        loading: _this.state.opLoading,\n        onClick: _this.insert\n      }, \"\\u6211\\u8981\\u6392\\u961F\")), __jsx(_Col, null, __jsx(_Button, {\n        disabled: !(status == 1),\n        loading: _this.state.opLoading,\n        onClick: function onClick() {\n          return _this.land(memberID);\n        }\n      }, \"\\u6211\\u5DF2\\u964D\\u843D\")), __jsx(_Col, null, __jsx(_Button, {\n        disabled: !(status == 2),\n        loading: _this.state.opLoading,\n        onClick: function onClick() {\n          return _this.out(memberID);\n        }\n      }, \"\\u6211\\u5DF2\\u8FD4\\u822A\")), __jsx(_Col, null, __jsx(_Button, {\n        disabled: !(status == 1),\n        loading: _this.state.opLoading,\n        onClick: function onClick() {\n          return _this.out(memberID);\n        }\n      }, \"\\u53D6\\u6D88\\u6392\\u961F\")), __jsx(_Col, null, __jsx(_Button, {\n        loading: _this.state.loading,\n        onClick: _this.getData\n      }, \"\\u5237\\u65B0\\u6570\\u636E\"))), __jsx(_Table, {\n        rowKey: function rowKey(record) {\n          return record.id;\n        },\n        dataSource: _this.state.queue.queue,\n        scroll: {\n          x: 'auto'\n        },\n        onChange: _this.onPageChange,\n        loading: _this.state.loading,\n        pagination: {\n          current: _this.state.page,\n          total: _this.state.total,\n          pageSize: _this.state.size,\n          showSizeChanger: true\n        },\n        columns: columns,\n        expandable: {\n          expandedRowRender: function expandedRowRender(record) {\n            return __jsx(_Descriptions, {\n              bordered: true\n            }, keys.map(function (item) {\n              var time = moment(record[item.key], 'X');\n              return __jsx(_Descriptions.Item, {\n                key: item.name,\n                label: item.time\n              }, record[item.key] == 0 ? '未到达该状态' : __jsx(_Tooltip, {\n                title: time.fromNow()\n              }, __jsx(\"span\", null, time.format('YYYY-MM-DD HH:mm:ss'))));\n            }));\n          }\n        }\n      }));\n    });\n\n    _this.state = {\n      loading: false,\n      formLoading: false,\n      total: 0,\n      queue: {\n        id: '',\n        leader: defaultContext.user,\n        password: '',\n        description: '',\n        max: 0,\n        create_time: 0,\n        finish_time: 0,\n        queue: []\n      },\n      all: false,\n      page: 1,\n      size: 10,\n      opLoading: false,\n      refresh: 0\n    };\n    return _this;\n  }\n\n  _createClass(QueueDetail, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.getData();\n      this.ws = new WebSocket('ws://127.0.0.1/api/notification/ws');\n\n      this.ws.onmessage = function (msg) {\n        var obj = JSON.parse(msg.data);\n        console.log(obj);\n\n        if (typeof obj.data === 'object' && typeof obj.data.message === 'string') {\n          H5Notification(obj.data.message);\n          ShowNotification({\n            success: true,\n            title: '排队通知',\n            content: obj.data.message\n          });\n        }\n      };\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.ws.close();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return __jsx(Container, null, __jsx(Context.Consumer, null, function (context) {\n        return __jsx(Head, null, __jsx(\"title\", null, \"\\u524D\\u5F80\".concat(_this2.props.queue.leader.ac_island, \"\\u5C9B(\").concat(_this2.props.queue.leader.ac_name, \")|\\u52A8\\u68EE\\u5019\\u673A\\u5927\\u5385|\").concat(context.blog_name)));\n      }), __jsx(_Space, {\n        direction: \"vertical\",\n        style: {\n          width: '100%'\n        }\n      }, __jsx(_Card, null, this.renderHeader()), __jsx(_Card, null, this.renderInfo()), __jsx(_Card, null, this.renderTable())));\n    }\n  }], [{\n    key: \"getInitialProps\",\n    value: function getInitialProps(args) {\n      var r;\n      return _regeneratorRuntime.async(function getInitialProps$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return _regeneratorRuntime.awrap(get(args.query.id));\n\n            case 2:\n              r = _context3.sent;\n              return _context3.abrupt(\"return\", {\n                queue: r.queue\n              });\n\n            case 4:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, null, null, null, _Promise);\n    }\n  }]);\n\n  return QueueDetail;\n}(React.Component);\n\n_defineProperty(QueueDetail, \"contextType\", Context);\n\nexport default withRouter(QueueDetail);","map":null,"metadata":{},"sourceType":"module"}