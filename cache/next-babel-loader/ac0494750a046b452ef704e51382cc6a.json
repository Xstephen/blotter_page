{"ast":null,"code":"import \"antd/lib/anchor/style/css\";\nimport _Anchor from \"antd/lib/anchor\";\nimport \"antd/lib/card/style/css\";\nimport _Card from \"antd/lib/card\";\nimport \"antd/lib/avatar/style/css\";\nimport _Avatar from \"antd/lib/avatar\";\nimport \"antd/lib/message/style/css\";\nimport _message from \"antd/lib/message\";\nimport \"antd/lib/divider/style/css\";\nimport _Divider from \"antd/lib/divider\";\nimport \"antd/lib/page-header/style/css\";\nimport _PageHeader from \"antd/lib/page-header\";\nimport \"antd/lib/button/style/css\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/skeleton/style/css\";\nimport _Skeleton from \"antd/lib/skeleton\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function () { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Fragment } from 'react';\nimport Head from 'next/head';\nimport Link from 'next/link';\nimport { withRouter } from 'next/router';\nimport { Icon } from '@ant-design/compatible';\nimport AntdIcon, { LinkOutlined, QqOutlined } from '@ant-design/icons';\nimport TagPart from '@/components/tag';\nimport CommentPart from '@/components/comment';\nimport Container from '@/components/container';\nimport { post, view } from '@/utils/api';\nimport { Context } from '@/utils/global';\nimport styles from './post.less';\nimport If from '@/components/if';\n\nfunction QzoneSVG() {\n  return __jsx(\"svg\", {\n    viewBox: \"0 0 1028 1024\",\n    version: \"1.1\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    fill: \"currentColor\",\n    width: \"1em\",\n    height: \"1em\"\n  }, __jsx(\"path\", {\n    d: \"M852.982272 693.76c-46.08 23.04-58.88 43.52-48.64 94.72 10.24 53.76 23.04 110.08 33.28 163.84 2.56 10.24 0 23.04 0 33.28-15.36-2.56-35.84 0-48.64-7.68-30.72-17.92-58.88-43.52-92.16-64-58.88-35.84-117.76-69.12-186.88-76.8-12.8-2.56-25.6 0-35.84 5.12-79.36 43.52-158.72 87.04-235.52 133.12-17.92 10.24-33.28 12.8-46.08 0-7.68-7.68-5.12-23.04-5.12-35.84 15.36-92.16 33.28-186.88 51.2-279.04 2.56-17.92 0-30.72-15.36-43.52-71.68-64-140.8-125.44-209.92-192-7.68-5.12-15.36-20.48-12.8-25.6 2.56-7.68 15.36-15.36 25.6-15.36 94.72-12.8 186.88-25.6 281.6-38.4 17.92-2.56 28.16-10.24 35.84-25.6 51.2-89.6 102.4-179.2 153.6-268.8 5.12-7.68 12.8-12.8 17.92-20.48 7.68 7.68 15.36 12.8 17.92 20.48 43.52 89.6 87.04 181.76 128 273.92 7.68 17.92 20.48 28.16 40.96 28.16 99.84 7.68 197.12 17.92 296.96 28.16 7.68 0 15.36 7.68 23.04 10.24-5.12 7.68-7.68 17.92-12.8 23.04-66.56 66.56-135.68 133.12-202.24 199.68-15.36 15.36-25.6 40.96-43.52 69.12-92.16-7.68-194.56-15.36-304.64-23.04 104.96-74.24 204.8-145.92 309.76-222.72-186.88-48.64-366.08-38.4-545.28-2.56 0 2.56 0 7.68 0 10.24 122.88 7.68 245.76 17.92 368.64 25.6 2.56 2.56 2.56 5.12 5.12 7.68-7.68 7.68-15.36 15.36-25.6 20.48-89.6 58.88-179.2 115.2-266.24 174.08-10.24 7.68-20.48 15.36-30.72 25.6C474.102272 734.72 663.542272 711.68 852.982272 693.76z\",\n    \"p-id\": \"2294\"\n  }));\n}\n\nvar PostPage = /*#__PURE__*/function (_React$Component) {\n  _inherits(PostPage, _React$Component);\n\n  var _super = _createSuper(PostPage);\n\n  _createClass(PostPage, null, [{\n    key: \"getInitialProps\",\n    value: function () {\n      var _getInitialProps = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(args) {\n        var url, r, anchors;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                url = args.query.url;\n\n                if (Array.isArray(url)) {\n                  url = url[0];\n                }\n\n                _context.next = 4;\n                return post(url);\n\n              case 4:\n                r = _context.sent;\n                anchors = PostPage.findAnchor(r.content);\n                return _context.abrupt(\"return\", {\n                  post: r,\n                  anchors: anchors\n                });\n\n              case 7:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function getInitialProps(_x) {\n        return _getInitialProps.apply(this, arguments);\n      }\n\n      return getInitialProps;\n    }()\n  }]);\n\n  function PostPage(props) {\n    var _this;\n\n    _classCallCheck(this, PostPage);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"render_post\", function () {\n      return _this.props.post === undefined ? __jsx(_Skeleton, {\n        active: true\n      }) : __jsx(\"article\", {\n        className: styles.post\n      }, __jsx(_PageHeader, {\n        className: \"shadow\",\n        title: _this.props.post.title\n      }, __jsx(\"div\", null, __jsx(\"div\", {\n        className: \"right20\"\n      }, __jsx(Icon, {\n        type: \"eye\",\n        className: \"right5\"\n      }), _this.props.post.view), __jsx(\"div\", {\n        className: \"right20\"\n      }, __jsx(Icon, {\n        type: \"calendar\",\n        className: \"right5\"\n      }), _this.props.post.publish_time), _this.props.post.publish_time == _this.props.post.edit_time ? null : __jsx(\"div\", {\n        className: \"right20\"\n      }, __jsx(Icon, {\n        type: \"edit\",\n        className: \"right5\"\n      }), _this.props.post.edit_time), __jsx(Context.Consumer, null, function (context) {\n        return (context.user.permission & 1) == 1 ? __jsx(Link, {\n          href: \"/admin/post?url=\".concat(_this.props.router.query.url)\n        }, __jsx(_Button, {\n          type: \"primary\",\n          size: \"small\"\n        }, \"\\u7F16\\u8F91\")) : null;\n      }), __jsx(If, {\n        condition: !!_this.props.post[\"abstract\"]\n      }, __jsx(\"blockquote\", null, _this.props.post[\"abstract\"])), __jsx(\"div\", null, __jsx(Icon, {\n        type: \"tag\",\n        className: \"right20\"\n      }), _this.props.post.tags.length > 0 ? _this.props.post.tags.map(function (tag) {\n        return __jsx(TagPart, {\n          key: tag[\"short\"],\n          tag: tag\n        });\n      }) : __jsx(\"span\", null, \"\\u65E0\\u6807\\u7B7E\")))), __jsx(If, {\n        condition: _this.props.post.head_image !== ''\n      }, __jsx(\"a\", {\n        className: \"headimage\",\n        target: \"_blank\",\n        rel: \"noopener noreferrer\",\n        href: _this.props.post.head_image\n      }, __jsx(\"img\", {\n        src: _this.props.post.head_image,\n        alt: _this.props.post.title\n      }))), __jsx(\"section\", {\n        className: \"post-content\",\n        dangerouslySetInnerHTML: {\n          __html: _this.props.post.content\n        }\n      }), __jsx(_Divider, null), __jsx(Context.Consumer, null, function (context) {\n        if (typeof document === 'undefined') return null;\n        var url = \"\".concat(context.root.replace(/\\/$/, ''), \"/\").concat(document.location.pathname.replace(/^\\//, ''));\n        var shares = [__jsx(\"a\", {\n          target: \"_blank\",\n          href: \"http://connect.qq.com/widget/shareqq/index.html?url=\".concat(encodeURIComponent(url), \"&sharesource=qzone&title=\").concat(encodeURIComponent(_this.props.post.title), \"&pics=\").concat(_this.props.post.head_image, \"&summary=\").concat(_this.props.post[\"abstract\"], \"&desc=\").concat(_this.props.post[\"abstract\"])\n        }, __jsx(QqOutlined, null)), __jsx(\"a\", {\n          target: \"_blank\",\n          href: \"https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=\".concat(encodeURIComponent(url), \"&sharesource=qzone&title=\").concat(encodeURIComponent(_this.props.post.title), \"&pics=\").concat(_this.props.post.head_image, \"&summary=\").concat(_this.props.post[\"abstract\"])\n        }, __jsx(AntdIcon, {\n          component: QzoneSVG\n        })), __jsx(LinkOutlined, {\n          onClick: function onClick() {\n            _message.info(\"\\u8BF7\\u590D\\u5236\\uFF1A\".concat(url), 10);\n          }\n        })];\n        return __jsx(_Card, {\n          type: \"inner\",\n          actions: shares\n        }, __jsx(_Card.Meta, {\n          avatar: __jsx(_Avatar, {\n            src: context.avatar\n          }),\n          title: context.author,\n          description: __jsx(\"div\", null, \"\\u672C\\u6587\\u7AE0\\u53D1\\u5E03\\u81EA\", __jsx(\"a\", {\n            href: context.root\n          }, context.blog_name), \"\\uFF0C\\u539F\\u6587\\u300E\", __jsx(\"a\", {\n            href: url\n          }, _this.props.post.title), \"\\u300F\", __jsx(\"br\", null), \"\\u5982\\u65E0\\u7279\\u522B\\u8BF4\\u660E\\uFF0C\\u53EF\\u4EE5\\u76F4\\u63A5\\u8F6C\\u8F7D\\uFF0C\\u4F46\\u8BF7\\u6CE8\\u660E\\u539F\\u6587\\u51FA\\u5904\\u94FE\\u63A5\\uFF1A\", __jsx(\"a\", {\n            href: url\n          }, url))\n        }));\n      }));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"render_anchor\", function (anchor) {\n      return __jsx(_Anchor.Link, {\n        key: \"\".concat(anchor.id, \"|\").concat(anchor.name),\n        href: anchor.id,\n        title: anchor.name\n      }, anchor.children.map(_this.render_anchor));\n    });\n\n    _this.state = {};\n    return _this;\n  }\n\n  _createClass(PostPage, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var url = this.props.router.query.url;\n\n      if (Array.isArray(url)) {\n        url = url[0];\n      }\n\n      view(url);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return typeof this.props.post === 'undefined' ? null : __jsx(Container, {\n        lg: 16\n      }, __jsx(Context.Consumer, null, function (context) {\n        return __jsx(Fragment, null, __jsx(Head, null, __jsx(\"title\", null, \"\".concat(_this2.props.post.title, \"|\").concat(context.blog_name)), __jsx(\"meta\", {\n          name: \"keywords\",\n          key: \"keywords\",\n          content: Array.isArray(_this2.props.post.keywords) ? _this2.props.post.keywords.join(',') : ''\n        }), __jsx(\"meta\", {\n          key: \"description\",\n          name: \"description\",\n          content: _this2.props.post[\"abstract\"]\n        })), __jsx(If, {\n          condition: context.big_screen\n        }, __jsx(_Anchor, {\n          offsetTop: 10,\n          style: {\n            maxHeight: 'calc(100% - 100px)',\n            background: 'transparent',\n            position: 'fixed',\n            top: '50px',\n            right: '30px',\n            width: '15%'\n          }\n        }, _this2.props.anchors.map(_this2.render_anchor))));\n      }), __jsx(_Card, null, this.render_post()), __jsx(_Card, null, __jsx(CommentPart, {\n        url: \"/post/\".concat(this.props.router.query.url)\n      })));\n    }\n  }], [{\n    key: \"findAnchor\",\n    value: function findAnchor(text) {\n      var re = new RegExp(\"<h([1-6]) id=\\\"(.*)\\\">(.*)</h\\\\1>\", 'g');\n      var result_list = [];\n\n      do {\n        var result = re.exec(text);\n\n        if (result !== null) {\n          result_list.push({\n            id: \"#\".concat(result[2]),\n            name: result[3],\n            level: parseInt(result[1]),\n            children: []\n          });\n        }\n      } while (result);\n\n      var anchors = [];\n\n      var insert = function insert(lst, value) {\n        if (lst.length > 0 && lst[lst.length - 1].level < value.level) {\n          insert(lst[lst.length - 1].children, value);\n        } else {\n          lst.push(value);\n        }\n      };\n\n      result_list.map(function (anchor) {\n        insert(anchors, anchor);\n      });\n      anchors.push({\n        id: '#blotter-comment',\n        name: '评论区',\n        level: 1,\n        children: []\n      });\n      return anchors;\n    }\n  }]);\n\n  return PostPage;\n}(React.Component);\n\n_defineProperty(PostPage, \"defaultProps\", {\n  anchors: []\n});\n\nexport default withRouter(PostPage);","map":null,"metadata":{},"sourceType":"module"}